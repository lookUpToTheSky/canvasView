(function(e){function t(t){for(var o,n,s=t[0],l=t[1],c=t[2],d=0,u=[];d<s.length;d++)n=s[d],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&u.push(i[n][0]),i[n]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);h&&h(t);while(u.length)u.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],o=!0,n=1;n<a.length;n++){var s=a[n];0!==i[s]&&(o=!1)}o&&(r.splice(t--,1),e=l(l.s=a[0]))}return e}var o={},n={app:0},i={app:0},r=[];function s(e){return l.p+"static/js/"+({}[e]||e)+"."+{"chunk-476618f3":"f4fa035c","chunk-4d8a513b":"34f31ae6","chunk-5a6ed638":"dc730dba","chunk-5c53cbae":"1665d1ce"}[e]+".js"}function l(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.e=function(e){var t=[],a={"chunk-476618f3":1,"chunk-4d8a513b":1,"chunk-5a6ed638":1,"chunk-5c53cbae":1};n[e]?t.push(n[e]):0!==n[e]&&a[e]&&t.push(n[e]=new Promise((function(t,a){for(var o="static/css/"+({}[e]||e)+"."+{"chunk-476618f3":"79091503","chunk-4d8a513b":"e04dc7bc","chunk-5a6ed638":"632d7686","chunk-5c53cbae":"9c57d36c"}[e]+".css",i=l.p+o,r=document.getElementsByTagName("link"),s=0;s<r.length;s++){var c=r[s],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===o||d===i))return t()}var u=document.getElementsByTagName("style");for(s=0;s<u.length;s++){c=u[s],d=c.getAttribute("data-href");if(d===o||d===i)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var o=t&&t.target&&t.target.src||i,r=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=o,delete n[e],h.parentNode.removeChild(h),a(r)},h.href=i;var p=document.getElementsByTagName("head")[0];p.appendChild(h)})).then((function(){n[e]=0})));var o=i[e];if(0!==o)if(o)t.push(o[2]);else{var r=new Promise((function(t,a){o=i[e]=[t,a]}));t.push(o[2]=r);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=s(e);var u=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(h);var a=i[e];if(0!==a){if(a){var o=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+o+": "+n+")",u.name="ChunkLoadError",u.type=o,u.request=n,a[1](u)}i[e]=void 0}};var h=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(t)},l.m=e,l.c=o,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(a,o,function(t){return e[t]}.bind(null,o));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var h=d;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0a59":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__,_toConsumableArray=__webpack_require__("e442").default,_objectSpread=__webpack_require__("08d7").default,_typeof=__webpack_require__("e9a2").default;__webpack_require__("4aa0"),__webpack_require__("2e9c"),__webpack_require__("da02"),__webpack_require__("5006"),__webpack_require__("cd46"),__webpack_require__("9dd2"),__webpack_require__("7e8e"),__webpack_require__("8a61"),__webpack_require__("f667"),__webpack_require__("5d63"),__webpack_require__("dc87"),__webpack_require__("e7a8"),__webpack_require__("1891"),__webpack_require__("d014"),__webpack_require__("61d9"),__webpack_require__("4822"),__webpack_require__("5122"),__webpack_require__("e939"),__webpack_require__("d515"),__webpack_require__("5998"),__webpack_require__("64a5"),__webpack_require__("8f44"),__webpack_require__("60d6"),function(e,t){"object"===_typeof(exports)&&"undefined"!==typeof module?module.exports=t():(__WEBPACK_AMD_DEFINE_FACTORY__=t,__WEBPACK_AMD_DEFINE_RESULT__="function"===typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__,void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(0,(function(){"use strict";console.log("欢迎使用 View2d version: 1.0.0 - 官网：http://***");var View2d={save:save,getData:getData,scene:null,Node:null,Group:null,$el:null,$template:null,ctx:null,nodes:[],lock:!1,activeNode:null,pen:{drawPath:!1,color:"#409EFF",showPath:!0,data:null},mode:{type:"edit",center:!0,scaleable:!1,moveable:!0,zoom:{max:5,min:.2}},color:["#409EFF","#ffffff","#c23531","#E6A23C","#67C23A","#91c7ae","#bda29a","#546570"],baseLine:{color:"orange",lineWidth:1,space:5,x:[],y:[]},checkbox:{show:!1,checkboxGroup:null,start:{x:0,y:0},end:{x:0,y:0},lineWidth:2,color:"#1890ff",background:"rgba(0,50,150,0.2)"},grid:{show:!1,lineWidth:.5,color:"rgba(225,225,225,0.8)",step:{x:30,y:30}},background:{color:"#000",image:""}};function save(e){var t=View2d.nodes.find((function(e){return e.constructor===View2d.scene}));t.scale(t.position,1,1),e=e||"View2d_data_"+Math.round(Math.random()*Math.pow(10,8));var a={baseLine:View2d.baseLine,grid:View2d.grid,background:View2d.background,nodes:View2d.nodes.filter((function(e){return null!=e.zIndex}))};a=JSON.stringify(a,void 0,4);var o=new Blob([a],{type:"text/json"}),n=document.createElement("a");n.href=window.URL.createObjectURL(o),n.download=e+".json",n.click()}function getData(){var e=View2d.nodes.find((function(e){return e.constructor===View2d.scene}));e.scale(e.position,1,1);var t={baseLine:View2d.baseLine,grid:View2d.grid,background:View2d.background,nodes:View2d.nodes.filter((function(e){return null!=e.zIndex}))};return t}var templateMousedown=!1;function drawgrid(){var e=View2d.grid,t=e.lineWidth,a=e.color,o=e.step,n=View2d.ctx;n.lineWidth=t,n.strokeStyle=a;for(var i=o.x+t;i<View2d.$el.width;i+=o.x)n.beginPath(),n.moveTo(i,0),n.lineTo(i,View2d.$el.height),n.stroke();for(var r=o.y+t;r<View2d.$el.height;r+=o.y)n.beginPath(),n.moveTo(0,r),n.lineTo(View2d.$el.width,r),n.stroke()}function drawLine(e){var t=View2d.ctx;t.save(),t.strokeStyle=View2d.baseLine.color,t.lineWidth=View2d.baseLine.lineWidth,t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.restore()}function darwCheckbox(e,t){var a=View2d.ctx;a.save(),a.strokeStyle=View2d.checkbox.color,a.fillStyle=View2d.checkbox.background,a.lineWidth=View2d.checkbox.lineWidth,a.beginPath(),a.rect(e.x,e.y,t.x-e.x,t.y-e.y),a.fill(),a.stroke(),a.restore()}function traverse(e){this.children.forEach((function(t,a){t.constructor==View2d.Group&&t.children.length>0?(t.traverse(e),e(t)):e(t)}))}View2d.scene=function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e||document.body,"string"===typeof e&&(e=document.querySelector(e)),this.scaleVal={x:1,y:1},this.children=[],this.zIndex=null,View2d.nodes=[],eventsList=[],View2d.checkbox.checkboxGroup=new View2d.Group({type:"extraGroup"}),this.width=e.clientWidth,this.height=e.clientHeight,this.position={x:this.width/2,y:this.height/2},View2d.$el=document.createElement("canvas"),View2d.$el.style.display="block",View2d.$el.width=this.width,View2d.$el.height=this.height,e.appendChild(View2d.$el),View2d.ctx=View2d.$el.getContext("2d"),View2d.$el.style.background="".concat(View2d.background.color," url(").concat(View2d.background.image,") no-repeat center"),View2d.$el.style.backgroundSize="100% 100%",View2d.$template=document.createElement("canvas"),View2d.$template.style.display="none",View2d.$template.width=this.width,View2d.$template.height=this.height,View2d.$template.style.position="absolute",View2d.$template.style.top="0",View2d.$template.style.left="0",View2d.$template.style.zIndex="2020",View2d.$template.style.background="rgba(0,0,0,0.3)",View2d.pen.ctx=View2d.$template.getContext("2d"),e.appendChild(View2d.$template),View2d.$template.addEventListener("mousedown",(function(){if(null!==View2d.pen.data&&1==event.buttons){templateMousedown=!0;var e={x:event.offsetX,y:event.offsetY,type:event.ctrlKey?"curve":"straight"};View2d.pen.data.linePath.push(e)}})),View2d.$template.addEventListener("mousemove",(function(){if(null!==View2d.pen.data){var e={x:event.offsetX,y:event.offsetY,type:event.ctrlKey?"curve":"straight"};View2d.pen.data.linePath.push(e),View2d.pen.data.linePath.length>1&&View2d.pen.data.linePath.splice(View2d.pen.data.linePath.length-2,1)}null!==View2d.pen.data&&(View2d.$template.style.display="block")}));var o=this;View2d.$template.addEventListener("contextmenu",(function(){if(event.preventDefault(),event.stopPropagation(),View2d.$template.style.display="none",templateMousedown&&View2d.pen.data.linePath.length>2){if("waterCapacity"==View2d.pen.data.shape&&View2d.pen.data.linePath.length<=3)return!1;View2d.pen.data.linePath.pop();var e=0,a=0,n=9999,i=9999;View2d.pen.data.linePath.forEach((function(t){e=e>t.x?e:t.x,a=a>t.y?a:t.y,n=n<t.x?n:t.x,i=i<t.y?i:t.y}));var r={x:n+(e-n)/2,y:i+(a-i)/2};View2d.pen.data.position=r,View2d.pen.data.linePath.forEach((function(e,t){View2d.pen.data.linePath[t].x=e.x-r.x,View2d.pen.data.linePath[t].y=e.y-r.y}));var s=new View2d.Node(View2d.pen.data);s.scale(1/t.scaleVal.x,1/t.scaleVal.y),o.add(s),templateMousedown=!1}View2d.pen.data=null})),View2d.$el.addEventListener("mousemove",(function(){null!==View2d.pen.data?View2d.$template.style.display="block":View2d.$template.style.display="none"})),View2d.$dom=document.createElement("div"),View2d.$dom.style.width=this.width+"px",View2d.$dom.style.height=this.height+"px",View2d.$dom.style.position="absolute",View2d.$dom.style.top="0",View2d.$dom.style.left="0",View2d.$dom.style.overflow="hidden",View2d.$dom.style.pointerEvents="none",e.appendChild(View2d.$dom);var n=this;if(this.add=function(e){if(void 0===e.vertex)return!1;e.parentId=void 0,e.zIndex=e.zIndex||n.children.length,n.children.push(e),e.constructor==View2d.Group&&e.traverse((function(e){e.constructor===View2d.Node&&drawNode(e,!0),"drawEcharts"==e.shape&&View2d.$dom.appendChild(e.element)})),e.constructor==View2d.Node&&drawNode(e,!0),View2d.lock||(e.dragEvents=[],e.on("drag"))},this.remove=function(e){n.children.forEach((function(t,a){t.name==e.name&&(n.children.splice(a,1),"drawEcharts"==t.shape&&View2d.$dom.removeChild(t.element),t.constructor==View2d.Group&&t.traverse((function(e){"drawEcharts"==e.shape&&View2d.$dom.removeChild(e.element)})))})),View2d.nodes.forEach((function(t,a){t.name==e.name&&(View2d.nodes[a].zIndex=null)})),View2d.activeNode=null},this.getRectArea=function(){var e=[],t=[];this.traverse((function(a){e.push(a.vertex[0].x,a.vertex[1].x,a.vertex[2].x,a.vertex[3].x),t.push(a.vertex[0].y,a.vertex[1].y,a.vertex[2].y,a.vertex[3].y)}));var a=Math.min.apply(Math,e),o=Math.max.apply(Math,e),n=Math.min.apply(Math,t),i=Math.max.apply(Math,t),r=[{x:a,y:n},{x:o,y:n},{x:o,y:i},{x:a,y:i}];return r},this.resize=function(){n.width=View2d.$el.parentElement.clientWidth,n.height=View2d.$el.parentElement.clientHeight,View2d.$el.width=n.width,View2d.$el.height=n.height,View2d.$template.width=n.width,View2d.$template.height=n.height,View2d.$dom.style.width=n.width+"px",View2d.$dom.style.height=n.height+"px";var e=n.getRectArea(),t=Math.round(e[1].x-e[0].x),a=Math.round(e[2].y-e[0].y),o=t/(n.width-10)/n.scaleVal.x,i=a/(n.height-10)/n.scaleVal.y,r={x:e[0].x+t/2,y:e[0].y+a/2},s={xl:n.width/2-r.x,yl:n.height/2-r.y};if(n.traverse((function(e){e.position.x+=s.xl,e.position.y+=s.yl,e.vertex.forEach((function(t,a){e.vertex[a].x+=s.xl,e.vertex[a].y+=s.yl}))})),"preview"==View2d.mode.type){var l=Math.max(o,i);n.scale(n.position,1/l,1/l)}},this.update=function(){null!==View2d.pen.data&&View2d.pen.ctx.clearRect(0,0,n.width,n.height);var e=View2d.ctx;e.clearRect(0,0,n.width,n.height),n.width=View2d.$el.parentElement.clientWidth,n.height=View2d.$el.parentElement.clientHeight,View2d.$el.width=n.width,View2d.$el.height=n.height,View2d.$template.width=n.width,View2d.$template.height=n.height,View2d.$dom.style.width=n.width+"px",View2d.$dom.style.height=n.height+"px",View2d.$el.style.background="".concat(View2d.background.color," url(").concat(View2d.background.image,") no-repeat center"),View2d.$el.style.backgroundSize="100% 100%",View2d.grid.show&&drawgrid(),this.children.sort((function(e,t){return e.zIndex-t.zIndex})),this.children.forEach((function(t){e.strokeStyle="#000",e.save(),t.constructor===View2d.Node&&drawNode(t,!0),t.constructor===View2d.Group&&t.traverse((function(e){e.constructor===View2d.Node&&drawNode(e,!0)})),e.restore(),t.helperBox&&setHeperBox(t),t.freeze&&"edit"==View2d.mode.type&&setFreezeBk(t)})),View2d.baseLine.x.length>0&&drawLine(View2d.baseLine.x),View2d.baseLine.y.length>0&&drawLine(View2d.baseLine.y),View2d.checkbox.show&&darwCheckbox(View2d.checkbox.start,View2d.checkbox.end),null!==View2d.pen.data&&darwLinePath()},this.scale=function(e,t,a){var o=this,i=t/this.scaleVal.x,r=a/this.scaleVal.y;this.position=_objectSpread({},e),this.traverse((function(e){var t=accountNodeScale(e,i,r);setVertexVal(t,e);var a={x:e.position.x-o.position.x,y:e.position.y-o.position.y},n=getRotatePos(a,{x:0,y:0},-t.rotateVal*Math.PI/180);n.x*=i,n.y*=r,a=getRotatePos(n,{x:0,y:0},t.rotateVal*Math.PI/180),resizeEchart(e);var s={x:o.position.x+a.x,y:o.position.y+a.y},l={xl:s.x-e.position.x,yl:s.y-e.position.y};e.vertex.forEach((function(t,a){e.vertex[a].x+=l.xl,e.vertex[a].y+=l.yl})),e.position=s})),n.scaleVal={x:t,y:a}},this.traverse=traverse,View2d.nodes.push(this),View2d.$el.attachEvent&&View2d.$el.attachEvent("onmousewheel",scrollScale),View2d.$el.addEventListener&&View2d.$el.addEventListener("DOMMouseScroll",scrollScale,!1),View2d.$el.onmousewheel=View2d.$el.onmousewheel=scrollScale,Object.keys(a).length>0){a.nodes=a.nodes.sort((function(e,t){return e.zIndex-t.zIndex}));var i=this;View2d.activeNode=null,a.nodes.forEach((function(e){if(null!==e.zIndex){var t=null;"extraGroup"==e.type?e.children.forEach((function(a){a.rotateVal+=e.rotateVal,a.scaleVal.x+=a.scaleVal.x*(e.scaleVal.x-1),a.scaleVal.y+=a.scaleVal.y*(e.scaleVal.y-1),void 0==a.children?(t=new View2d.Node(a),resizeEchart(t),t.events.forEach((function(e){e.isDrag||"drag"===e.events||t.on(e.events,e.callBack,e.callBack1,e.callBack2)}))):(t=new View2d.Group(a),t=setToNode(t)),t.helperBox=!1,t.zIndex=null,i.add(t)})):(void 0==e.children?(t=new View2d.Node(e),resizeEchart(t),t.events.forEach((function(e){e.isDrag||"drag"===e.events||t.on(e.events,e.callBack)}))):(t=new View2d.Group(e),t=setToNode(t),t.events.forEach((function(e){e.isDrag||"drag"===e.events||t.on(e.events,e.callBack)}))),t.helperBox=!1,t.zIndex=null,i.add(t))}})),this.resize(),View2d.baseLine=a.baseLine,View2d.background=a.background,View2d.grid=a.grid}};var allRotate=0,allScale={x:1,y:1};function drawNode(node,boolean){var ctx=View2d.ctx;ctx.save(),ctx.lineWidth=node.lineWidth||1,ctx.shadowOffsetX=node.shadowOffsetX||0,ctx.shadowOffsetY=node.shadowOffsetY||0,ctx.shadowColor=node.shadowColor||"orange",ctx.shadowBlur=node.shadowBlur||0,allRotate=0;var scene=View2d.nodes.find((function(e){return e.constructor===View2d.scene}));allScale=_objectSpread({},scene.scaleVal),parentTransform.call(node);var parent=node.findParent();if(ctx.setTransform(Math.cos(allRotate),Math.sin(allRotate),-Math.sin(allRotate),Math.cos(allRotate),node.position.x,node.position.y),ctx.scale(allScale.x,allScale.y),node.allScale=allScale,node.allRotate=allRotate,"function"===typeof node.createNode){var str=node.createNode.toString(),reg=/\/\/(?=ctx.fill\(\)|ctx.stroke\(\))/g,nodeFunc=str.replace(reg,"");node.createNode=new Function("return "+nodeFunc)(),node.createNode({ctx:ctx,node:node,x:node.originPosition.x,y:node.originPosition.y})}else eval(node.shape+"(node, !!boolean)");ctx.scale(1/allScale.x,1/allScale.y),autoText(node,scene),ctx.restore()}function parentTransform(){var e=this;if(void 0!==this.parentId){var t=View2d.nodes.find((function(t){return t.groupId==e.parentId}));parentTransform.call(t)}allRotate+=this.rotateVal*Math.PI/180,allScale={x:this.scaleVal.x*allScale.x,y:this.scaleVal.y*allScale.y}}function autoText(e,t){var a=View2d.ctx;a.textBaseline="middle";var o={x:1,y:1};o.x=t.scaleVal.x,o.y=t.scaleVal.y,a.scale(o.x,o.y);var n=e.text,i=n.color,r=n.fontSize,s=n.fontFamily,l=n.lineHeight,c=n.fontWeight,d=n.fontStyle,u=n.textAlign,h=n.textVertical,p=n.padding,v=n.textShadowOffsetX,f=n.textShadowOffsetY,x=n.textShadowColor,m=n.textShadowBlur;a.fillStyle=i,a.font="".concat(d," ").concat(c," ").concat(r,"px ").concat(s),a.shadowOffsetX=v,a.shadowOffsetY=f,a.shadowColor=x,a.shadowBlur=m;var y=e.vertex[0].x-e.vertex[1].x,w=e.vertex[0].y-e.vertex[1].y,_=Math.sqrt(y*y+w*w)-2*p[1]*o.x,b=e.vertex[1].x-e.vertex[2].x,g=e.vertex[1].y-e.vertex[2].y,V=Math.sqrt(b*b+g*g)-2*p[0]*o.x,k=0,N=e.text.content||"",P=a.measureText(N).width*o.x,C=Math.ceil(P/_),M=C>1?0:(_-P)/2,S=(V-C*l*o.x)/2;switch(h){case"top":S=0;break;case"bottom":S=0,V=-V+C*l*o.x*2+l*o.x;break}switch(u){case"left":M=0;break;case"right":M=C>1?0:_-P;break}var E=-_/2+M,I=-V/2+S+l*o.x/2;a.beginPath();for(var T=0;T<N.length;T++){var D=a.measureText(N[T]).width*o.x;k+D>=_&&(k=0,I+=l*o.x,E=a.measureText(N.slice(T)).width*o.x<_&&"left"!==u?"center"==u?-a.measureText(N.slice(T)).width*o.x/2:_/2-a.measureText(N.slice(T)).width*o.x:-_/2),a.fillText(N[T],E/o.x,I/o.x),E+=D,k+=D}}function setHeperBox(e){var t=e.findParent(),a=View2d.ctx;a.save(),a.lineWidth=2,a.beginPath(),a.strokeStyle=e.freeze?"#ccc":"#2cafe7",a.fillStyle="#fff",e.vertex.forEach((function(e,o){a.save(),a.translate(e.x,e.y),a.rotate(t.rotateVal*Math.PI/180),a.lineTo(0,0),a.restore()})),a.closePath(),a.stroke();var o={x:e.vertex[0].x+(e.vertex[1].x-e.vertex[0].x)/2,y:e.vertex[0].y+(e.vertex[1].y-e.vertex[0].y)/2};a.strokeStyle=e.freeze?"#ccc":"#2cafe7",a.fillStyle="#fff",a.beginPath(),a.moveTo(o.x,o.y),a.lineTo(o.x+50*Math.sin(e.rotateVal*Math.PI/180),o.y-50*Math.cos(e.rotateVal*Math.PI/180)),a.stroke(),a.beginPath(),a.arc(o.x+50*Math.sin(e.rotateVal*Math.PI/180),o.y-50*Math.cos(e.rotateVal*Math.PI/180),6,0,2*Math.PI),a.stroke(),a.fill(),a.beginPath(),a.strokeStyle=e.freeze?"#ccc":"#2cafe7",a.fillStyle="#fff",e.vertex.forEach((function(o,n){var i,r;a.save(),a.translate(o.x,o.y),a.rotate(t.rotateVal*Math.PI/180),a.lineTo(0,0),a.strokeRect(-5,-5,10,10),a.fillRect(-5,-5,10,10),a.restore(),a.save(),n!==e.vertex.length-1?(i=e.vertex[n].x-(e.vertex[n].x-e.vertex[n+1].x)/2,r=e.vertex[n].y-(e.vertex[n].y-e.vertex[n+1].y)/2):(i=e.vertex[n].x-(e.vertex[n].x-e.vertex[0].x)/2,r=e.vertex[n].y-(e.vertex[n].y-e.vertex[0].y)/2),a.translate(i,r),a.rotate(t.rotateVal*Math.PI/180),a.strokeRect(-5,-5,10,10),a.fillRect(-5,-5,10,10),a.restore()})),a.restore(),e.constructor===View2d.Group&&e.traverse((function(t){a.lineWidth=1,a.strokeStyle=e.freeze?"#ccc":"#2cafe7",a.beginPath(),t.vertex.forEach((function(e){a.lineTo(e.x,e.y)})),a.closePath(),a.stroke()}))}function darwLinePath(){var ctx=View2d.pen.ctx,data=View2d.pen.data;ctx.save(),ctx.lineWidth=data.lineWidth||1,eval(data.shape+"(data, true, ctx)"),ctx.restore(),ctx.strokeStyle=View2d.pen.color||"#fff",ctx.lineWidth=View2d.pen.lineWidth||1,(View2d.pen.showPath||"waterCapacity"==node.shape)&&(ctx.save(),ctx.beginPath(),_darwlinePath(data.linePath,ctx),ctx.restore(),ctx.stroke())}function setFreezeBk(e){var t=View2d.ctx;t.save(),t.strokeStyle="#ccc",t.beginPath(),t.fillStyle="rgba(10,10,25,0.5)",e.vertex.forEach((function(e){t.lineTo(e.x,e.y)})),t.closePath(),t.stroke(),t.fill(),t.restore()}View2d.Group=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(void 0!==e.vertex){for(var t in e=deepClone(e),e)this[t]=e[t];return this.name="group"+Math.floor(Math.random()*Math.pow(10,5)),this.groupId=View2d.nodes.length+1,View2d.nodes.push(this),!1}if(this.type="group",this.freeze=!1,this.children=[],this.events=[],this.dragEvents=[],this.helperBox=!1,this.zIndex=null,this.rotateVal=0,this.scaleVal={x:1,y:1},this.groupPosition={x:0,y:0},this.originPosition={x:0,y:0},this.position={x:0,y:0},this.DValue={x:0,y:0},this.name=e.name||"group"+Math.floor(Math.random()*Math.pow(10,5)),Object.keys(e).length>0)for(var a in this.originPosition=_objectSpread({},e.position),this.position=_objectSpread({},e.position),e)this[a]=e[a];this.groupId=View2d.nodes.length+1,View2d.nodes.push(this)},View2d.Group.prototype.add=function(){var e=this,t=arguments;this.scaleVal={x:1,y:1},this.rotateVal=0,this.children.forEach((function(t){t.rotateVal+=e.rotateVal,t.scaleVal.x+=(e.scaleVal.x-1)*t.scaleVal.x,t.scaleVal.y+=(e.scaleVal.y-1)*t.scaleVal.y}));var a=View2d.nodes.find((function(e){return e.constructor===View2d.scene})),o=[],n=[];void 0!==this.vertex&&(o=[this.vertex[0].x,this.vertex[1].x],n=[this.vertex[0].y,this.vertex[2].y]);var i=function(i){var r,s;(a.children.forEach((function(e){e.name===t[i].name&&(a.remove(e),"drawEcharts"==e.shape&&View2d.$dom.appendChild(e.element))})),e.children.push(t[i]),t[i].parentId=e.groupId,t[i].constructor===View2d.Group)?t[i].traverse((function(e){var t,a;e.constructor===View2d.Node&&((t=o).push.apply(t,_toConsumableArray(e.vertex.map((function(e){return e.x})))),(a=n).push.apply(a,_toConsumableArray(e.vertex.map((function(e){return e.y})))))})):((r=o).push.apply(r,_toConsumableArray(t[i].vertex.map((function(e){return e.x})))),(s=n).push.apply(s,_toConsumableArray(t[i].vertex.map((function(e){return e.y})))))};for(var r in arguments)i(r);var s=Math.min.apply(Math,_toConsumableArray(o)),l=Math.max.apply(Math,_toConsumableArray(o)),c=Math.min.apply(Math,_toConsumableArray(n)),d=Math.max.apply(Math,_toConsumableArray(n));this.vertex=[{x:s,y:c},{x:l,y:c},{x:l,y:d},{x:s,y:d}];var u={x:s+(l-s)/2,y:c+(d-c)/2};this.position=_objectSpread({},u),this.originPosition=_objectSpread({},u);var h=this.findParent();u=_objectSpread({},h.position),this.children.forEach((function(t){t.groupPosition={x:t.position.x-e.position.x,y:t.position.y-e.position.y}}))},View2d.Group.prototype.remove=function(){var e=arguments,t=this,a=[],o=[],n=[];this.children.forEach((function(a,o){var i=!1;for(var r in e){var s=e[r].constructor===View2d.Node?"nodeId":"groupId";a[s]==e[r][s]&&(a.rotateVal+=t.rotateVal,a.scaleVal.x+=(t.scaleVal.x-1)*a.scaleVal.x,a.scaleVal.y+=(t.scaleVal.y-1)*a.scaleVal.y,e[r].groupPosition={x:0,y:0},e[r].zIndex=null,e[r].parentId=void 0,i=!0)}i||n.push(a)})),this.children=n,this.traverse((function(e){e.vertex.forEach((function(e){a.push(e.x),o.push(e.y)}))}));var i=Math.min.apply(Math,a),r=Math.max.apply(Math,a),s=Math.min.apply(Math,o),l=Math.max.apply(Math,o);this.vertex=[{x:i,y:s},{x:r,y:s},{x:r,y:l},{x:i,y:l}];var c={x:i+(r-i)/2,y:s+(l-s)/2};this.position=_objectSpread({},c),this.traverse((function(e){e.rotateVal+=t.rotateVal,e.scaleVal.x+=(t.scaleVal.x-1)*e.scaleVal.x,e.scaleVal.y+=(t.scaleVal.y-1)*e.scaleVal.y,e.groupPosition={x:e.position.x-t.position.x,y:e.position.y-t.position.y}})),this.scaleVal={x:1,y:1},this.rotateVal=0},View2d.Group.prototype.combine=function(){if("extraGroup"==this.type){var e=View2d.nodes.find((function(e){return e.constructor==View2d.scene})),t=this.children;this.children=[];var a=this.clone();t.forEach((function(e){e.parentId=a.groupId})),a.children=t.sort((function(e,t){return e.zIndex-t.zIndex})),a.type="group",e.remove(this),e.add(a),View2d.activeNode=a}},View2d.Group.prototype.unCombine=function(){var e=this,t=View2d.nodes.find((function(e){return e.constructor==View2d.scene}));this.children.forEach((function(a){t.remove(e),a.rotateVal+=e.rotateVal,a.scaleVal.x+=a.scaleVal.x*(e.scaleVal.x-1),a.scaleVal.y+=a.scaleVal.y*(e.scaleVal.y-1),"group"===a.type&&(a.groupPosition={x:0,y:0}),"drawEcharts"==a.shape&&View2d.$dom.appendChild(a.element),a.constructor==View2d.Group&&a.traverse((function(e){"drawEcharts"==e.shape&&View2d.$dom.appendChild(e.element)})),t.add(a)})),this.children=[]},View2d.Group.prototype.findParent=findParent,View2d.Group.prototype.accountVertex=accountVertex,View2d.Group.prototype.translate=translate,View2d.Group.prototype.rotate=rotate,View2d.Group.prototype.clone=clone,View2d.Group.prototype.checkPointInPath=checkPointInPath,View2d.Group.prototype.traverse=traverse,View2d.Group.prototype.on=setEvents,View2d.Group.prototype.scale=scale,View2d.Group.prototype.off=offEvents,View2d.Group.prototype.offAll=offAllEvents;var eventsList=[],hasSetEvent=[],dragStartOffset={},dragNodeZIndex=null,isDrag=!1;function textDefault(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return t.content=e.content||"",t.color=e.color||"#fff",t.fontSize=e.fontSize||20,t.fontFamily=e.fontFamily||"kaiTi",t.lineHeight=e.lineHeight||t.fontSize,t.fontWeight=e.fontWeight||"normal",t.fontStyle=e.fontStyle||"normal",t.textAlign=e.textAlign||"center",t.textVertical=e.textVertical||"center",t.padding=e.padding||[0,0],t.shadowOffsetX=e.textShadowOffsetX||0,t.shadowOffsetY=e.textShadowOffsetY||0,t.shadowColor=e.textShadowColor||"orange",t.shadowBlur=e.textShadowBlur||0,t}function borderDefault(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return t.show=e.show||!1,t.color=e.color||"#ccc",t.lineWidth=e.lineWidth||1,t.lineCap=e.lineCap||"square",t.lineJoin=e.lineJoin||"round",t.lineDash=e.lineDash||[0,0],t}function accountVertex(){View2d.nodes.push(this);for(var e=0,t=0,a=9999,o=9999,n=-100;n<View2d.$el.width;n+=1)for(var i=-100;i<View2d.$el.height;i+=1)View2d.ctx.isPointInPath(n,i)&&(e=e>n?e:n,t=t>i?t:i,a=a<n?a:n,o=o<i?o:i);var r={x:a+(e-a)/2,y:o+(t-o)/2};0==Object.keys(this.position).length||void 0==this.parentId?(0!==Object.keys(this.position).length?(this.DValue={x:this.position.x-r.x,y:this.position.y-r.y},this.position={x:r.x+this.DValue.x,y:r.y+this.DValue.y},this.originPosition=_objectSpread({},r)):(this.position=_objectSpread({},r),this.originPosition=_objectSpread({},r)),this.vertex=[{x:a,y:o},{x:e,y:o},{x:e,y:t},{x:a,y:t}]):(this.groupPosition={x:this.position.x-r.x,y:this.position.y-r.y},this.vertex=[{x:a+this.groupPosition.x,y:o+this.groupPosition.y},{x:e+this.groupPosition.x,y:o+this.groupPosition.y},{x:e+this.groupPosition.x,y:t+this.groupPosition.y},{x:a+this.groupPosition.x,y:t+this.groupPosition.y}]);var s=View2d.nodes.find((function(e){return e.constructor===View2d.scene}));this.scale(s.scaleVal.x,s.scaleVal.y),this.scaleVal={x:1,y:1}}function handleElement(e,t){if("drawEcharts"==e.shape){var a=document.createElement("div");a.style.width=e.params.w+"px",a.style.height=e.params.h+"px",a.style.position="absolute",a.style.zIndex=999,t.element=a,View2d.$dom.appendChild(a);var o=echarts.init(a);o.setOption(e.echartsOption,!0)}if("drawVideo"==e.shape){var n=document.createElement("video");n.autoplay=t.autoplay=e.autoplay,n.src=t.src=e.src,n.onerror=function(){t.src=!1},t.element=n}if("drawImage"==e.shape){var i=new Image;i.src=t.src=e.src,t.element=i}if("dom"==e.shape){var r=document.createElement("div");r.style.width=e.params.w+"px",r.style.height=e.params.h+"px",r.style.position="absolute",r.style.zIndex=999,t.element=r,View2d.$dom.appendChild(r)}}function findParent(){var e=this,t={};if(void 0!==this.parentId){var a=View2d.nodes.find((function(t){return t.groupId==e.parentId}));t=a.findParent()}else t=this;return t}function accountNodeScale(e,t,a){nodeRotateVal=0,nodeRotate.call(e);var o=180*nodeRotateVal/Math.PI,n=e.vertex,i=n[0].x-n[1].x,r=n[0].y-n[1].y,s=Math.sqrt(i*i+r*r)/2,l=n[1].x-n[2].x,c=n[1].y-n[2].y,d=Math.sqrt(l*l+c*c)/2,u=s*(t-1),h=d*(a-1),p=Math.cos(o*Math.PI/180)*u,v=Math.sin(o*Math.PI/180)*u,f=Math.sin(o*Math.PI/180)*h,x=Math.cos(o*Math.PI/180)*h;return{dx:p,dx1:f,dy:v,dy1:x,rotateVal:o}}View2d.Node=function(data){if(void 0!==data.linePath&&data.linePath.length<2)return data.color="undefined"==typeof data.color?View2d.color:data.color,data.color=_toConsumableArray(data.color),View2d.pen.data=data,!1;if(void 0!==data.vertex){for(var k in data=deepClone(data),data)data.hasOwnProperty(k)&&void 0!==data[k]&&(this[k]=data[k]);return handleElement(data,this),this.helperBox=!1,this.name="node"+Math.floor(Math.random()*Math.pow(10,5)),this.nodeId=View2d.nodes.length,View2d.nodes.push(this),!1}this.events=[],this.dragEvents=[],this.type="node",this.rotateVal=data.rotateVal||0,this.scaleVal={x:1,y:1},this.createNode=null,this.freeze=!1,this.originPosition=_objectSpread({},data.position),this.color="undefined"==typeof data.color?View2d.color:data.color,this.color=_toConsumableArray(this.color),this.text=textDefault(data.text),this.shadowOffsetX=data.shadowOffsetX||0,this.shadowOffsetY=data.shadowOffsetY||0,this.shadowColor=data.shadowColor||"orange",this.shadowBlur=data.shadowBlur||0,this.border=borderDefault(data.border),void 0==data.position&&(this.originPosition={x:0,y:0}),this.position=_objectSpread({},data.position),this.name=data.name||"node"+Math.floor(Math.random()*Math.pow(10,5)),this.nodeId=View2d.nodes.length+1,this.zIndex=null,this.helperBox=!1,this.vertex=[],this.groupPosition=data.groupPosition||{x:0,y:0},this.DValue={x:0,y:0};var ctx=View2d.ctx;if(ctx.save(),ctx.translate(this.position.x,this.position.y),ctx.rotate(this.rotateVal*Math.PI/180),ctx.scale(this.scaleVal.x,this.scaleVal.y),handleElement(data,this),"function"!==typeof data&&"function"!==typeof data.createNode){for(var _k2 in this.drawType=data.drawType||"fill",this.lineWidth=data.lineWidth||1,data)this[_k2]=this[_k2]||data[_k2];eval(data["shape"]+"(this)"),this.accountVertex(),ctx.restore()}else{ctx.restore();var reg=/(?=ctx.stroke\(\)|ctx.fill\(\))/g,reg1=/(?=\/\/ctx.stroke\(\)|\/\/ctx.fill\(\))/g,nodeFunc=null;if("function"==typeof data)nodeFunc=data.toString();else{for(var _k3 in nodeFunc=data.createNode.toString(),data)this[_k3]=data[_k3];View2d.nodes.push(this)}nodeFunc=nodeFunc.replace(reg,"//"),nodeFunc=nodeFunc.replace(reg1,"this.accountVertex();"),this.createNode=new Function("return "+nodeFunc)(),this.createNode({ctx:ctx,node:this,x:0,y:0}),nodeFunc=nodeFunc.replace(/this.accountVertex\(\);/g,""),this.createNode=new Function("return "+nodeFunc)()}},View2d.Node.prototype.accountVertex=accountVertex,View2d.Node.prototype.translate=translate,View2d.Node.prototype.rotate=rotate,View2d.Node.prototype.scale=scale,View2d.Node.prototype.clone=clone,View2d.Node.prototype.findParent=findParent,View2d.Node.prototype.checkPointInPath=checkPointInPath,View2d.Node.prototype.linearGradient=linearGradient,View2d.Node.prototype.radialGradient=radialGradient,View2d.Node.prototype.on=setEvents,View2d.Node.prototype.off=offEvents,View2d.Node.prototype.offAll=offAllEvents;var nodeRotateVal=0;function nodeRotate(){var e=this;if(void 0!==this.parentId){var t=View2d.nodes.find((function(t){return t.groupId==e.parentId}));nodeRotate.call(t)}nodeRotateVal+=this.rotateVal*Math.PI/180}function setVertexVal(e,t){var a=e.dx,o=e.dx1,n=e.dy,i=e.dy1;t.vertex[0].x+=-a+o,t.vertex[0].y+=-n-i,t.vertex[3].x+=-a-o,t.vertex[3].y+=-n+i,t.vertex[1].x+=a+o,t.vertex[1].y+=n-i,t.vertex[2].x+=a-o,t.vertex[2].y+=n+i}function scale(e,t){var a=e/this.scaleVal.x,o=t/this.scaleVal.y,n=accountNodeScale(this,a,o);setVertexVal(n,this),this.constructor==View2d.Group&&this.traverse((function(e){var t=accountNodeScale(e,a,o);setVertexVal(t,e);var n=View2d.nodes.find((function(t){return t.groupId==e.parentId})),i=getRotatePos(e.groupPosition,{x:0,y:0},-t.rotateVal*Math.PI/180);i.x*=a,i.y*=o,e.groupPosition=getRotatePos(i,{x:0,y:0},t.rotateVal*Math.PI/180),e.translate({x:n.position.x+e.groupPosition.x,y:n.position.y+e.groupPosition.y}),resizeEchart(e)})),this.scaleVal={x:e,y:t},resizeEchart(this)}function resizeEchart(e){e.echartsOption&&setTimeout((function(){var t=echarts.init(e.element);t.resize()}),50)}var rotateTimer=null;function rotate(e){var t=this;rotateTimer||(rotateTimer=setTimeout((function(){var a=t.position.x,o=t.position.y,n=(e-t.rotateVal)*Math.PI/180;t.rotateVal=e,t.vertex.forEach((function(e,i){var r=(e.x-a)*Math.cos(n)-(e.y-o)*Math.sin(n)+a,s=(e.x-a)*Math.sin(n)+(e.y-o)*Math.cos(n)+o;t.vertex[i]={x:r,y:s}})),t.constructor==View2d.Group&&t.traverse((function(e){var t=[],i=[];e.vertex.forEach((function(r,s){var l=(r.x-a)*Math.cos(n)-(r.y-o)*Math.sin(n)+a,c=(r.x-a)*Math.sin(n)+(r.y-o)*Math.cos(n)+o;e.vertex[s]={x:l,y:c},t.push(l),i.push(c)}));var r=Math.min.apply(Math,t),s=Math.max.apply(Math,t),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y},e.groupPosition=getRotatePos(e.groupPosition,{x:0,y:0},n)})),rotateTimer=null}),30))}function translate(e){var t=this,a={xl:e.x-this.position.x,yl:e.y-this.position.y};this.vertex.forEach((function(e,o){t.vertex[o].x+=a.xl,t.vertex[o].y+=a.yl})),this.position=e,this.constructor==View2d.Group&&this.traverse((function(e){e.position.x+=a.xl,e.position.y+=a.yl,e.vertex.forEach((function(t,o){e.vertex[o].x+=a.xl,e.vertex[o].y+=a.yl}))}))}function clone(){var e={};return e=deepClone(this),e.zIndex=null,void 0===e.children?e=new View2d.Node(e):(e=new View2d.Group(e),e=setToNode(e)),e}function deepClone(e){var t=null;if(e instanceof Object&&"function"!==typeof e&&e.constructor!==RegExp){for(var a in t=Array.isArray(e)?[]:{},e)"element"!==a||"color"!==a?(e instanceof Array||e.hasOwnProperty(a))&&(t[a]=deepClone(e[a])):t[a]=e[a];return t}return e}function setToNode(e){return e.children.forEach((function(t,a){if(t.parentId=e.groupId,void 0==t.children)return e.children[a]=new View2d.Node(t),e;e.children[a]=new View2d.Group(t),e.children[a]=setToNode(e.children[a])})),e}function offEvents(events){var _this12=this,eventTypesList=this.events.map((function(e){return e.events}));eventTypesList.indexOf(events)>-1&&this.events.split(eventTypesList.indexOf(events),1),eventsList=eventsList.filter((function(e){return"drag"===events?_this12.nodeId!==e.node.nodeId&&!(_this12.nodeId==e.node.nodeId&&e.isDrag):!(_this12.nodeId==e.node.nodeId&&e.events===events)})),"hover"!==events&&"drag"!==events?(View2d.$el.removeEventListener(events,eval(events+"Fun")),View2d.$el.addEventListener(events,eval(events+"Fun"))):(View2d.$el.removeEventListener("mousemove",eval(events+"Fun")),View2d.$el.addEventListener("mousemove",eval(events+"Fun")))}function offAllEvents(){var _this13=this;this.events=[],eventsList=eventsList.filter((function(e){return _this13.name!==e.node.name}));var temp=[];eventsList.forEach((function(e){temp.includes(e.events)||temp.push(e.events)})),temp.forEach((function(events){"hover"!==events&&"drag"!==events?(View2d.$el.removeEventListener(events,eval(events+"Fun")),View2d.$el.addEventListener(events,eval(events+"Fun"))):(View2d.$el.removeEventListener("mousemove",eval(events+"Fun")),View2d.$el.addEventListener("mousemove",eval(events+"Fun")))}))}function setEvents(events,callBack,callBack1,callBack2){var _this14=this,params={};this.events=this.events.filter((function(e){if(e.events!==events)return e;params=e.params})),eventsList=eventsList.filter((function(e){return e.events!==events||e.events==events&&e.node.name!==_this14.name})),"hover"!==events&&"drag"!==events?(isDrag?this.dragEvents.push({events:events,isDrag:isDrag,isHover:!1,callBack:callBack,params:params}):this.events.push({events:events,isDrag:isDrag,isHover:!1,callBack:callBack,params:params}),eventsList.unshift({events:events,isDrag:isDrag,isHover:!1,callBack:callBack,node:this}),hasSetEvent.includes(events)&&(View2d.$el.removeEventListener(events,eval(events+"Fun")),hasSetEvent=hasSetEvent.filter((function(e){return e.events!=events}))),View2d.$el.addEventListener(events,eval(events+"Fun")),hasSetEvent.push(events)):("drag"==events||isDrag?this.dragEvents.push({events:events,isDrag:!0,isHover:!1,callBack:callBack,params:params}):this.events.push({events:events,isDrag:!1,isHover:!1,callBack:callBack,callBack1:callBack1,params:params}),eventsList.unshift({events:events,callBack:callBack,callBack1:callBack1,callBack2:callBack2,node:this}),hasSetEvent.includes(events)&&(View2d.$el.removeEventListener("mousemove",eval(events+"Fun")),hasSetEvent=hasSetEvent.filter((function(e){return e.events!=events}))),View2d.$el.addEventListener("mousemove",eval(events+"Fun")),hasSetEvent.push(events),"drag"==events&&(isDrag=!0,this.on("mousedown",(function(e){dragNodeZIndex=_this14.zIndex;var t=View2d.nodes.sort((function(e,t){return t.zIndex-e.zIndex}))[0].zIndex;_this14.zIndex=t+1,dragStartOffset={offsetX:e.clientX-_this14.position.x,offsetY:e.clientY-_this14.position.y},_this14.isMousedown=!0,"function"==typeof callBack&&callBack.call(_this14,e)})),this.on("mouseup",(function(){_this14.isMousedown&&(_this14.isMousedown=!1,"function"==typeof callBack2&&callBack2.call(_this14,e),_this14.zIndex=dragNodeZIndex,View2d.baseLine.x=[],View2d.baseLine.y=[])})),isDrag=!1))}function hoverFun(){var e=eventsList.filter((function(e){return"hover"==e.events}));eventHandle(e,event)}function dragFun(){var e=eventsList.filter((function(e){return"drag"==e.events}));eventHandle(e,event)}function clickFun(){var e=eventsList.filter((function(e){return"click"==e.events}));eventHandle(e,event)}function dblclickFun(){var e=eventsList.filter((function(e){return"dblclick"==e.events}));eventHandle(e,event)}function mouseupFun(){var e=eventsList.filter((function(e){return"mouseup"==e.events}));eventHandle(e,event)}function mousedownFun(){var e=eventsList.filter((function(e){return"mousedown"==e.events}));eventHandle(e,event)}function checkPointInPath(e,t){if(void 0!=this.vertex){var a=View2d.ctx;return a.beginPath(),this.vertex.forEach((function(e){a.lineTo(e.x,e.y)})),a.isPointInPath(e,t)}}function isRangeIn(e,t,a){var o=parseFloat(e);return o<=t&&o>=a}window.addEventListener("mouseup",(function(){View2d.activeNode&&(View2d.activeNode.isMousedown=!1,hoverVertex=-1,mousedownVertex=!1),checkboxEnd()}));var mousedownVertex=!1,start={},end={},hoverVertex=-1;function eventHandle(e,t){var a=View2d.nodes.find((function(e){return e.constructor===View2d.scene}));if(0===e.length||0===a.children.length)return View2d.$el.style.cursor="default",!1;var o=[];a.traverse((function(e){o.push(e.name)}));var n=e.filter((function(e){return o.includes(e.node.name)})),i=!1,r=t.clientX-View2d.$el.getBoundingClientRect().left,s=t.clientY-View2d.$el.getBoundingClientRect().top,l=View2d.nodes.filter((function(e){return null!==e.zIndex}));l.sort((function(e,t){return t.zIndex-e.zIndex}));var c=l.filter((function(e){return e.checkPointInPath(r,s)}));if(View2d.lock&&"drag"==n[0].events)return View2d.$el.style.cursor="default",!1;if(c.length>1){var d=c[0].events.concat(c[0].dragEvents);if(!d.map((function(e){return e.events})).includes(n[0].events)){var u=!1;if(c[0].constructor===View2d.Group&&d.traverse((function(e){e.includes(n[0].events)&&(u=!0)})),!u){var h=n.filter((function(e){return"hover"===e.events}))[0];return h&&"hover"===h.events&&h.isHover&&h.callBack1&&(h.callBack1.call(ele.node,t),h.isHover=!1),!1}}}if(View2d.lock||controler(r,s,c),hoverVertex>-1)return!1;if("preview"!==View2d.mode.type){if("mousedown"===t.type&&-1==hoverVertex)if(c.length>0)if(t.ctrlKey&&null!==View2d.activeNode&&View2d.activeNode.name!==c[0].name){var p=View2d.checkbox.checkboxGroup.children;0==p.length?(p.push(View2d.activeNode,c[0]),shortTimeCombine(p)):View2d.checkbox.checkboxGroup.add(c[0])}else l.forEach((function(e){e.helperBox=!1})),c[0].helperBox=!0,View2d.activeNode=c[0];else l.forEach((function(e){e.helperBox=!1})),View2d.activeNode=null,unShortTimeCombine();0==c.length&&"mousedown"==n[0].events&&checkboxStart(r,s),"mouseup"==n[0].events&&View2d.checkbox.show&&(t.stopPropagation(),checkboxEnd(r,s)),"drag"==n[0].events&&View2d.checkbox.show&&checkboxMove(r,s)}n.sort((function(e,t){return t.node.zIndex-e.node.zIndex})),n.forEach((function(e){View2d.nodes.find((function(e){return e.constructor===View2d.scene}));if(!View2d.nodes.some((function(t){return t.name===e.node.name})))return!1;if(e.node.checkPointInPath(r,s)&&!i){if(i=!0,"drag"!==e.events)e.isHover&&"hover"===e.events||(e.callBack.call(e.node,t),"click"==e.events&&(e.node.isOn=!e.node.isOn),"hover"===e.events&&(e.isHover=!0));else if("function"==typeof e.callBack1&&e.callBack1.call(e.node,t),e.node.isMousedown&&!e.node.freeze){var a=t.clientX-dragStartOffset.offsetX,o=t.clientY-dragStartOffset.offsetY;e.node.translate({x:a,y:o}),findVertex(a,o)}}else"hover"===e.events&&e.isHover&&("function"==typeof e.callBack1&&e.callBack1.call(e.node,t),e.isHover=!1);if(!e.node.checkPointInPath(r,s)&&"drag"==e.events&&e.node.isMousedown&&!e.node.freeze){var n=t.clientX-dragStartOffset.offsetX,l=t.clientY-dragStartOffset.offsetY;e.node.translate({x:n,y:l}),findVertex(n,l)}}))}function findVertex(e,t){var a=!1,o=!1,n={x:0,y:0};View2d.nodes.filter((function(e){return null!==e.zIndex}));if(null==View2d.activeNode||"preview"==View2d.mode.type)return!1;var i={xMin:View2d.activeNode.vertex[0].x,xMax:View2d.activeNode.vertex[1].x,yMin:View2d.activeNode.vertex[0].y,yMax:View2d.activeNode.vertex[2].y},r=View2d.baseLine.space||5;View2d.nodes.forEach((function(s){if(null!==s.zIndex&&View2d.activeNode.nodeId!==s.nodeId){var l=s.vertex[0].x,c=s.vertex[1].x,d=s.vertex[0].y,u=s.vertex[2].y;for(var h in i)/^x/.test(h)&&(isRangeIn(i[h],l+r,l-r)&&(0==n.y&&(n.y=t),n.x=e+l-i[h],View2d.baseLine.x=[{x:l,y:0},{x:l,y:View2d.$el.height}],a=!0),isRangeIn(i[h],c+r,c-r)&&(0==n.y&&(n.y=t),n.x=e+c-i[h],View2d.baseLine.x=[{x:c,y:0},{x:c,y:View2d.$el.height}],a=!0)),/^y/.test(h)&&(isRangeIn(i[h],d+r,d-r)&&(0==n.x&&(n.x=e),n.y=t+d-i[h],View2d.baseLine.y=[{x:0,y:d},{x:View2d.$el.width,y:d}],o=!0),isRangeIn(i[h],u+r,u-r)&&(0==n.x&&(n.x=e),n.y=t+u-i[h],View2d.baseLine.y=[{x:0,y:u},{x:View2d.$el.width,y:u}],o=!0))}})),(a||o)&&View2d.activeNode.translate(n),a||(View2d.baseLine.x=[]),o||(View2d.baseLine.y=[])}function getCenterPoint(e,t){var a={x:e.x-(e.x-t.x)/2,y:e.y-(e.y-t.y)/2};return a}function getRotatePos(e,t,a){var o=t.x,n=t.y,i=(e.x-o)*Math.cos(a)-(e.y-n)*Math.sin(a)+o,r=(e.x-o)*Math.sin(a)+(e.y-n)*Math.cos(a)+n;return{x:i,y:r}}var RESIZECUR=[];function sortResizeCur(){var e=Math.abs(Math.round(View2d.activeNode.rotateVal%360/45));switch(e){case 0:RESIZECUR=["nw","s","ne","e","nw","s","ne","e"];break;case 1:RESIZECUR=["s","ne","e","nw","s","ne","e","nw"];break;case 2:RESIZECUR=["ne","e","nw","s","ne","e","nw","s"];break;case 3:RESIZECUR=["e","nw","s","ne","e","nw","s","ne"];break;case 4:RESIZECUR=["nw","s","ne","e","nw","s","ne","e"];break;case 5:RESIZECUR=["s","ne","e","nw","s","ne","e","nw"];break;case 6:RESIZECUR=["ne","e","nw","s","ne","e","nw","s"];break;case 7:RESIZECUR=["e","nw","s","ne","e","nw","s","ne"];break;case 8:RESIZECUR=["nw","s","ne","e","nw","s","ne","e"];break}}function controler(e,t,a){if("preview"==View2d.mode.type)return!1;if(mousedownVertex||(hoverVertex=-1),-1!=hoverVertex||mousedownVertex||(View2d.$el.style.cursor="",a.length>0&&!a[0].freeze&&a[0].dragEvents.map((function(e){return e.events})).includes("drag")&&(View2d.$el.style.cursor="move")),null!==View2d.activeNode&&!View2d.activeNode.freeze){var o=JSON.parse(JSON.stringify(View2d.activeNode.vertex)),n={x:o[0].x+(o[1].x-o[0].x)/2,y:o[0].y+(o[1].y-o[0].y)/2},i=o.map((function(e){return e.x})).sort((function(e,t){return e-t})),r=o.map((function(e){return e.y})).sort((function(e,t){return e-t})),s={xMin:i[0],xMax:i[3],yMin:r[0],yMax:r[3]};s.xMin,s.xMax,s.yMin,s.yMax;if(-1==hoverVertex){sortResizeCur(),isRangeIn(e,o[0].x+5,o[0].x-5)&&isRangeIn(t,o[0].y+5,o[0].y-5)&&(hoverVertex=0,View2d.$el.style.cursor=RESIZECUR[0]+"-resize"),isRangeIn(e,o[1].x+5,o[1].x-5)&&isRangeIn(t,o[1].y+5,o[1].y-5)&&(hoverVertex=1,View2d.$el.style.cursor=RESIZECUR[2]+"-resize"),isRangeIn(e,o[2].x+5,o[2].x-5)&&isRangeIn(t,o[2].y+5,o[2].y-5)&&(hoverVertex=2,View2d.$el.style.cursor=RESIZECUR[4]+"-resize"),isRangeIn(e,o[3].x+5,o[3].x-5)&&isRangeIn(t,o[3].y+5,o[3].y-5)&&(hoverVertex=3,View2d.$el.style.cursor=RESIZECUR[6]+"-resize");var l=getCenterPoint(o[0],o[1]);isRangeIn(e,l.x+5,l.x-5)&&isRangeIn(t,l.y+5,l.y-5)&&(hoverVertex=.5,View2d.$el.style.cursor=RESIZECUR[1]+"-resize"),l=getCenterPoint(o[1],o[2]),isRangeIn(e,l.x+5,l.x-5)&&isRangeIn(t,l.y+5,l.y-5)&&(hoverVertex=1.5,View2d.$el.style.cursor=RESIZECUR[3]+"-resize"),l=getCenterPoint(o[2],o[3]),isRangeIn(e,l.x+5,l.x-5)&&isRangeIn(t,l.y+5,l.y-5)&&(hoverVertex=2.5,View2d.$el.style.cursor=RESIZECUR[5]+"-resize"),l=getCenterPoint(o[3],o[0]),isRangeIn(e,l.x+5,l.x-5)&&isRangeIn(t,l.y+5,l.y-5)&&(hoverVertex=3.5,View2d.$el.style.cursor=RESIZECUR[7]+"-resize");var c=50*Math.sin(View2d.activeNode.rotateVal*Math.PI/180),d=50*Math.cos(View2d.activeNode.rotateVal*Math.PI/180);isRangeIn(e,n.x+5+c,n.x-5+c)&&isRangeIn(t,n.y+5-d,n.y-5-d)&&(hoverVertex=4,View2d.$el.style.cursor="url(./img/rotate.ico) 16 16,default")}if("mousedown"===event.type&&hoverVertex>-1&&(mousedownVertex=!0,start={x:e,y:t}),mousedownVertex){var u=View2d.activeNode.rotateVal*Math.PI/180,h={xl:e-start.x,yl:t-start.y},p=1,v=1;start={x:e,y:t};var f=Math.atan2(h.yl,h.xl),x=Math.sqrt(h.xl*h.xl+h.yl*h.yl),m=f-u,y=o[0].x-o[1].x,w=o[0].y-o[1].y,_=Math.cos(m)*x/Math.sqrt(y*y+w*w);y=o[1].x-o[2].x,w=o[1].y-o[2].y;var b=Math.sin(m)*x/Math.sqrt(y*y+w*w);switch(hoverVertex){case 0:if(p=View2d.activeNode.scaleVal.x-_*View2d.activeNode.scaleVal.x,v=View2d.activeNode.scaleVal.y-b*View2d.activeNode.scaleVal.y,p<.1||v<.1)break;var g=p/View2d.activeNode.scaleVal.x,V=v/View2d.activeNode.scaleVal.y,k=accountNodeScale(View2d.activeNode,g,V);o[0].x+=2*k.dx1-2*k.dx,o[0].y-=2*k.dy1+2*k.dy,o[1].x+=2*k.dx1,o[1].y-=2*k.dy1,o[3].x-=2*k.dx,o[3].y-=2*k.dy,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,g,V);e.vertex[0].x+=2*t.dx1-2*t.dx,e.vertex[0].y-=2*t.dy1+2*t.dy,e.vertex[1].x+=2*t.dx1,e.vertex[1].y-=2*t.dy1,e.vertex[3].x-=2*t.dx,e.vertex[3].y-=2*t.dy,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-t.rotateVal);o.x*=g,o.y*=V,e.groupPosition=getRotatePos(o,{x:0,y:0},t.rotateVal),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.x=p,View2d.activeNode.scaleVal.y=v;break;case 1:if(p=View2d.activeNode.scaleVal.x+_*View2d.activeNode.scaleVal.x,v=View2d.activeNode.scaleVal.y-b*View2d.activeNode.scaleVal.y,p<.1||v<.1)break;var N=p/View2d.activeNode.scaleVal.x,P=v/View2d.activeNode.scaleVal.y,C=accountNodeScale(View2d.activeNode,N,P);o[1].x+=2*C.dx1+2*C.dx,o[1].y-=2*C.dy1-2*C.dy,o[2].x+=2*C.dx,o[2].y+=2*C.dy,o[0].x+=2*C.dx1,o[0].y-=2*C.dy1,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,N,P);e.vertex[1].x+=2*t.dx1+2*t.dx,e.vertex[1].y-=2*t.dy1-2*t.dy,e.vertex[2].x+=2*t.dx,e.vertex[2].y+=2*t.dy,e.vertex[0].x+=2*t.dx1,e.vertex[0].y-=2*t.dy1,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-u);o.x*=N,o.y*=P,e.groupPosition=getRotatePos(o,{x:0,y:0},u),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.x=p,View2d.activeNode.scaleVal.y=v;break;case 2:if(p=View2d.activeNode.scaleVal.x+_*View2d.activeNode.scaleVal.x,v=View2d.activeNode.scaleVal.y+b*View2d.activeNode.scaleVal.y,p<.1||v<.1)break;var M=p/View2d.activeNode.scaleVal.x,S=v/View2d.activeNode.scaleVal.y,E=accountNodeScale(View2d.activeNode,M,S);o[2].x-=2*E.dx1-2*E.dx,o[2].y+=2*E.dy1+2*E.dy,o[1].x+=2*E.dx,o[1].y+=2*E.dy,o[3].x-=2*E.dx1,o[3].y+=2*E.dy1,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,M,S);e.vertex[2].x-=2*t.dx1-2*t.dx,e.vertex[2].y+=2*t.dy1+2*t.dy,e.vertex[1].x+=2*t.dx,e.vertex[1].y+=2*t.dy,e.vertex[3].x-=2*t.dx1,e.vertex[3].y+=2*t.dy1,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-u);o.x*=M,o.y*=S,e.groupPosition=getRotatePos(o,{x:0,y:0},u),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.x=p,View2d.activeNode.scaleVal.y=v;break;case 3:if(p=View2d.activeNode.scaleVal.x-_*View2d.activeNode.scaleVal.x,v=View2d.activeNode.scaleVal.y+b*View2d.activeNode.scaleVal.y,p<.1||v<.1)break;var I=p/View2d.activeNode.scaleVal.x,T=v/View2d.activeNode.scaleVal.y,D=accountNodeScale(View2d.activeNode,I,T);o[3].x-=2*D.dx1+2*D.dx,o[3].y+=2*D.dy1-2*D.dy,o[0].x-=2*D.dx,o[0].y-=2*D.dy,o[2].x-=2*D.dx1,o[2].y+=2*D.dy1,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,I,T);e.vertex[3].x-=2*t.dx1+2*t.dx,e.vertex[3].y+=2*t.dy1-2*t.dy,e.vertex[0].x-=2*t.dx,e.vertex[0].y-=2*t.dy,e.vertex[2].x-=2*t.dx1,e.vertex[2].y+=2*t.dy1,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-u);o.x*=I,o.y*=T,e.groupPosition=getRotatePos(o,{x:0,y:0},u),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.x=p,View2d.activeNode.scaleVal.y=v;break;case.5:if(v=View2d.activeNode.scaleVal.y-b*View2d.activeNode.scaleVal.y,v<.1)break;var O=v/View2d.activeNode.scaleVal.y,$=accountNodeScale(View2d.activeNode,1,O);o[0].x+=2*$.dx1,o[0].y-=2*$.dy1,o[1].x+=2*$.dx1,o[1].y-=2*$.dy1,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,1,O);e.vertex[0].x+=2*t.dx1,e.vertex[0].y-=2*t.dy1,e.vertex[1].x+=2*t.dx1,e.vertex[1].y-=2*t.dy1,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-u);o.y*=O,e.groupPosition=getRotatePos(o,{x:0,y:0},u),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.y=v;break;case 1.5:if(p=View2d.activeNode.scaleVal.x+_*View2d.activeNode.scaleVal.x,p<.1)break;var z=p/View2d.activeNode.scaleVal.x,A=accountNodeScale(View2d.activeNode,z,1);o[1].x+=2*A.dx,o[1].y+=2*A.dy,o[2].x+=2*A.dx,o[2].y+=2*A.dy,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,z,1);e.vertex[1].x+=2*t.dx,e.vertex[1].y+=2*t.dy,e.vertex[2].x+=2*t.dx,e.vertex[2].y+=2*t.dy,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-u);o.x*=z,e.groupPosition=getRotatePos(o,{x:0,y:0},u),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.x=p;break;case 2.5:if(v=View2d.activeNode.scaleVal.y+b*View2d.activeNode.scaleVal.y,v<.1)break;var R=v/View2d.activeNode.scaleVal.y,L=accountNodeScale(View2d.activeNode,1,R);o[2].x-=2*L.dx1,o[2].y+=2*L.dy1,o[3].x-=2*L.dx1,o[3].y+=2*L.dy1,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,1,R);e.vertex[2].x-=2*t.dx1,e.vertex[2].y+=2*t.dy1,e.vertex[3].x-=2*t.dx1,e.vertex[3].y+=2*t.dy1,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-u);o.y*=R,e.groupPosition=getRotatePos(o,{x:0,y:0},u),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.y=v;break;case 3.5:if(p=View2d.activeNode.scaleVal.x-_*View2d.activeNode.scaleVal.x,p<.1)break;var B=p/View2d.activeNode.scaleVal.x,W=accountNodeScale(View2d.activeNode,B,1);o[0].x-=2*W.dx,o[0].y-=2*W.dy,o[3].x-=2*W.dx,o[3].y-=2*W.dy,View2d.activeNode.constructor==View2d.Group&&View2d.activeNode.traverse((function(e){var t=accountNodeScale(e,B,1);e.vertex[0].x-=2*t.dx,e.vertex[0].y-=2*t.dy,e.vertex[3].x-=2*t.dx,e.vertex[3].y-=2*t.dy,resizeEchart(e);var a=View2d.nodes.find((function(t){return t.groupId==e.parentId})),o=getRotatePos(e.groupPosition,{x:0,y:0},-u);o.x*=B,e.groupPosition=getRotatePos(o,{x:0,y:0},u),e.translate({x:a.position.x+e.groupPosition.x,y:a.position.y+e.groupPosition.y});var n=[],i=[];e.vertex.forEach((function(t,a){n.push(e.vertex[a].x),i.push(e.vertex[a].y)}));var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=Math.min.apply(Math,i),c=Math.max.apply(Math,i);e.position={x:r+(s-r)/2+e.DValue.x*View2d.activeNode.scaleVal.x,y:l+(c-l)/2+e.DValue.y*View2d.activeNode.scaleVal.y}})),View2d.activeNode.scaleVal.x=p;break;case 4:var j=e-View2d.activeNode.position.x,F=t-View2d.activeNode.position.y,q=180*-Math.atan(j/F)/Math.PI;t<=s.yMin+(s.yMax-s.yMin)/2&&e>=s.xMin+(s.xMax-s.xMin)/2?View2d.activeNode.rotate(q):t<=s.yMin+(s.yMax-s.yMin)/2&&e<=s.xMin+(s.xMax-s.xMin)/2?View2d.activeNode.rotate(360+q):View2d.activeNode.rotate(180+q);break}if(4!==hoverVertex){View2d.activeNode.vertex=_toConsumableArray(o);var G={x:o[0].x+(o[2].x-o[0].x)/2,y:o[0].y+(o[2].y-o[0].y)/2};if(View2d.activeNode.position={x:G.x+View2d.activeNode.DValue.x*View2d.activeNode.scaleVal.x,y:G.y+View2d.activeNode.DValue.y*View2d.activeNode.scaleVal.y},View2d.activeNode.echartsOption){var U=echarts.init(View2d.activeNode.element);U.resize()}}}if("mouseup"===event.type&&mousedownVertex&&(mousedownVertex=!1,end={x:e,y:t}),mousedownVertex)return}}function checkboxStart(e,t){View2d.checkbox.show=!0,View2d.checkbox.start={x:e,y:t},View2d.checkbox.end={x:e,y:t}}function checkboxMove(e,t){View2d.checkbox.end={x:e,y:t}}function checkboxEnd(e,t){if(View2d.checkbox.show){checkboxIncludeNode();View2d.checkbox.show=!1,View2d.checkbox.start={x:0,y:0},View2d.checkbox.end={x:0,y:0}}}function checkboxIncludeNode(){var e=[],t=View2d.checkbox,a=t.start,o=t.end,n=Math.min(a.x,o.x),i=Math.max(a.x,o.x),r=Math.min(a.y,o.y),s=Math.max(a.y,o.y);return View2d.nodes.forEach((function(t){if(null!==t.zIndex){var a={xMin:t.vertex[0].x,xMax:t.vertex[1].x,yMin:t.vertex[0].y,yMax:t.vertex[2].y};n<a.xMax&&i>a.xMin&&r<a.yMax&&s>a.yMin&&e.push(t)}})),e.length>1&&shortTimeCombine(e),1==e.length&&(View2d.activeNode=e[0],e[0].helperBox=!0),e}function scrollScale(){var e=0;event||(event=window.event),event.wheelDelta?(e=event.wheelDelta/120,window.opera&&(e=-e)):event.detail&&(e=-event.detail/3);var t=View2d.nodes.find((function(e){return e.constructor===View2d.scene})),a=t.scaleVal,o=a.x,n=a.y;e&&(o+=.03*e,n+=.03*e,o>View2d.mode.zoom.min&&o<View2d.mode.zoom.max&&t.scale({x:event.offsetX,y:event.offsetY},o,n))}function shortTimeCombine(e){var t=View2d.nodes.find((function(e){return e.constructor==View2d.scene}));e=e.filter((function(e){return!e.freeze})),e=e.sort((function(e,t){return e.zIndex-t.zIndex}));var a=View2d.checkbox.checkboxGroup;a.children=[],a.vertex=void 0,a.add.apply(a,_toConsumableArray(e)),a.helperBox=!0,View2d.activeNode=a,t.add(a)}function unShortTimeCombine(){var e=View2d.nodes.find((function(e){return e.constructor==View2d.scene}));View2d.nodes.forEach((function(t){null!==t.zIndex&&"extraGroup"==t.type&&(e.remove(t),t.children.forEach((function(a){a.rotateVal+=t.rotateVal,a.scaleVal.x+=a.scaleVal.x*(t.scaleVal.x-1),a.scaleVal.y+=a.scaleVal.y*(t.scaleVal.y-1),a.freeze=t.freeze,"group"===a.type&&(a.groupPosition={x:0,y:0}),"drawEcharts"==a.shape&&View2d.$dom.appendChild(a.element),a.constructor==View2d.Group&&a.traverse((function(e){"drawEcharts"==e.shape&&View2d.$dom.appendChild(e.element)})),e.add(a)})),t.freeze=!1,t.children=[])}))}function radialGradient(){var e;if(0==this.vertex.length)return!1;var t=null,a={xMin:this.vertex[0].x/this.allScale.x,xMax:this.vertex[1].x/this.allScale.x,yMin:this.vertex[0].y/this.allScale.x,yMax:this.vertex[2].y/this.allScale.x},o=a.xMin,n=a.xMax,i=a.yMin,r=a.yMax,s=[{x:(o-n)/2,y:(i-r)/2},{x:(n-o)/2,y:(i-r)/2},{x:(n-o)/2,y:(r-i)/2},{x:(o-n)/2,y:(r-i)/2}],l=Math.abs(o-n)/2,c=["center","top","bottom","left","right","left top","right top","left bottom","right bottom"];switch(arguments[0]){case"center":s=[0,0,l/5,0,0,l];break;case"top":s=[0,-l,l/5,0,-l,2*l];break;case"bottom":s=[0,l,l/5,0,l,2*l];break;case"left":s=[-l,0,l/5,-l,0,2*l];break;case"right":s=[l,0,l/5,l,0,2*l];break;case"left top":s=[s[0].x,s[0].y,l/5,s[0].x,s[0].y,2*l];break;case"right top":s=[s[1].x,s[1].y,l/5,s[1].x,s[1].y,2*l];break;case"left bottom":s=[s[3].x,s[3].y,l/5,s[3].x,s[3].y,2*l];break;case"right bottom":s=[s[2].x,s[2].y,l/5,s[2].x,s[2].y,2*l];break;default:s=[0,0,l/5,0,0,l];break}t=(e=View2d.ctx).createRadialGradient.apply(e,_toConsumableArray(s));var d=0;for(var u in c.includes(arguments[0])&&(d=1),arguments)c.includes(arguments[u])||t.addColorStop(1*(Number(u)-d)/(arguments.length-1-d),arguments[u]);return t}function linearGradient(){var e;if(0==this.vertex.length)return!1;var t=null,a={xMin:this.vertex[0].x/this.allScale.x,xMax:this.vertex[1].x/this.allScale.x,yMin:this.vertex[0].y/this.allScale.y,yMax:this.vertex[2].y/this.allScale.y},o=a.xMin,n=a.xMax,i=a.yMin,r=a.yMax,s=[{x:(o-n)/2,y:(i-r)/2},{x:(n-o)/2,y:(i-r)/2},{x:(n-o)/2,y:(r-i)/2},{x:(o-n)/2,y:(r-i)/2}];switch(arguments[0]){case"to bottom":s=[s[0].x,s[0].y,s[3].x,s[3].y];break;case"to right":s=[s[0].x,s[0].y,s[1].x,s[1].y];break;case"45deg":s=[s[3].x,s[3].y,s[1].x,s[1].y];break;case"135deg":s=[s[0].x,s[0].y,s[2].x,s[2].y];break;default:s=[s[0].x,s[0].y,s[1].x,s[1].y];break}t=(e=View2d.ctx).createLinearGradient.apply(e,_toConsumableArray(s));var l=0,c=["to bottom","to right","45deg","135deg"];for(var d in c.includes(arguments[0])&&(l=1),arguments)c.includes(arguments[d])||t.addColorStop(1*(Number(d)-l)/(arguments.length-1-l),arguments[d]);return t}function nodeSetColor(node){var color=[];return node.color.forEach((function(item){"object"===_typeof(item)?color.push(eval(node[item.type+"Gradient"](item.direction,item.gradient[0],item.gradient[1]))):color.push(item)})),color}function polygon(e,t){var a,o,n=View2d.ctx,i=nodeSetColor(e);for(o=2*Math.PI/e.params.num,n.fillStyle=n.strokeStyle=i[0],n.beginPath(),a=0;a<e.params.num;a++)n.rotate(o),n.lineTo(0,-e.params.w);n.closePath(),t&&n[e.drawType](),t&&e.border.show&&(n.lineWidth=e.border.lineWidth||1,n.strokeStyle=e.border.color||"red",n.lineCap=e.border.lineCap||"butt",n.lineJoin=e.border.lineJoin||"miter",n.setLineDash(e.border.lineDash||[0,0]),n.stroke()),n.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h)}function arc(e,t){var a=View2d.ctx,o=nodeSetColor(e);a.fillStyle=a.strokeStyle=o[0],a.beginPath(),a.arc(0,0,e.params.r,e.params.start,e.params.end),t&&a[e.drawType](),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||1,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke())}function rect(e,t){var a=View2d.ctx,o=nodeSetColor(e);a.fillStyle=a.strokeStyle=o[0],a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),t&&a[e.drawType](),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||1,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke())}function fivePointedStart(e,t){var a=View2d.ctx,o=nodeSetColor(e);a.fillStyle=a.strokeStyle=o[0],a.beginPath();for(var n=0;n<5;n++)a.lineTo(Math.cos((18+72*n)/180*Math.PI)*e.params.size,-Math.sin((18+72*n)/180*Math.PI)*e.params.size),a.lineTo(Math.cos((54+72*n)/180*Math.PI)*e.params.size/2.5,-Math.sin((54+72*n)/180*Math.PI)*e.params.size/2.5);a.closePath(),t&&a[e.drawType](),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||1,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke())}function channel(e,t,a){var o=a||View2d.ctx;e.offset=e.offset||0,e.isOn&&(e.offset+=e.speed||.2),o.lineWidth=e.lineWidth||20;var n=nodeSetColor(e);o.strokeStyle=n[0],o.lineCap="square",o.lineJoin="round",o.beginPath(),_darwlinePath(e.linePath,o),o.stroke(),o.strokeStyle=n[1],e.lineWidth?o.lineWidth=e.lineWidth-e.lineWidth/2.5:o.lineWidth=14,o.setLineDash([o.lineWidth,2*o.lineWidth]),o.lineDashOffset-=5*e.offset,o.stroke()}function waterCapacity(e,t,a){var o,n,i,r,s=a||View2d.ctx,l=[],c=[],d=nodeSetColor(e);s.fillStyle=d[0],s.beginPath(),e.linePath.forEach((function(e){l.push(e.x),c.push(e.y)})),_darwlinePath(e.linePath,s),s.clip(),s.closePath(),t&&s.fill(),o=Math.max.apply(Math,l)+200,n=Math.min.apply(Math,l)-200,i=Math.max.apply(Math,c)+200,r=Math.min.apply(Math,c)-200,s.fillStyle=d[1],e.offset=e.offset||1,e.isOn&&(e.offset+=e.speed||.2),s.beginPath();var u=[{x:n,y:r},{x:o,y:r},{x:o,y:i},{x:n,y:i}],h=[].concat(u).reverse();h.forEach((function(t,a){if(2==a)for(var l=0,c=o;c>n;c-=(o-n)/200)l++,200===l&&(c=n),s.lineTo(c,i-(i-r)*e.waterHeight+2*Math.sin(.1*c+e.offset/5));else s.lineTo(t.x,t.y)})),s.closePath(),t&&s.fill(),s.beginPath(),_darwlinePath(e.linePath,s)}function drawImage(e,t){var a=View2d.ctx,o=nodeSetColor(e);a.strokeStyle=a.fillStyle=o[0]||"#000",a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),t&&a[e.drawType](),a.strokeStyle=a.fillStyle=o[1]||"#fff",e.element||(a.beginPath(),a.font="18px kaiTi",a.textAlign="center",a.fillText("图片加载失败",0,9),t&&a[e.drawType](),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),t&&a.stroke()),a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),t&&e.element&&a.drawImage(e.element,-e.params.w/2,-e.params.h/2,e.params.w,e.params.h)}function drawVideo(e,t){var a=View2d.ctx,o=nodeSetColor(e);a.fillStyle=o[0]||"#000",a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),t&&a[e.drawType](),t&&e.src&&a.drawImage(e.element,-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),e.isOn&&e.src?e.element.play():e.src?(e.element.pause(),a.fillStyle=o[1]||"#fff",a.beginPath(),a.lineTo(10/e.scaleVal.x,0),a.lineTo(-10/e.scaleVal.x,-15/e.scaleVal.y),a.lineTo(-10/e.scaleVal.x,15/e.scaleVal.y),t&&a.fill()):(a.fillStyle="#fff",a.beginPath(),a.font="18px kaiTi",a.textAlign="center",a.fillText("视频加载失败",0,9)),a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h)}function drawText(e,t){var a=View2d.ctx,o=nodeSetColor(e);a.fillStyle=o[0]||"#fff",a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),a.clip(),t&&a.fill(),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||1,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke())}function drawEcharts(e,t){var a=View2d.ctx,o=nodeSetColor(e);if(e.element){var n=e.position.x-e.params.w/2,i=e.position.y-e.params.h/2,r=e.rotateVal,s=e.scaleVal.x,l=e.scaleVal.y;void 0!==e.allScale&&(s=e.allScale.x,l=e.allScale.y,r=180*e.allRotate/Math.PI),e.element.style.left=n-(s-1)*e.params.w/2+"px",e.element.style.top=i-(l-1)*e.params.h/2+"px",e.element.style.width=s*e.params.w+"px",e.element.style.height=l*e.params.h+"px",e.element.style.pointerEvents="preview"==View2d.mode.type?"auto":"none",e.element.style.transform="rotateZ(".concat(r,"deg)")}a.fillStyle=o[0],a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),t&&a.fill(),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||1,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke())}function drawSwitch(e,t){var a=View2d.ctx,o=nodeSetColor(e);a.beginPath(),a.fillStyle=e.isOn?o[0]:"#ccc",a.lineTo(-24,20),a.arcTo(-150,20,-24,-20,20),a.lineTo(-24,-20),a.lineTo(24,-20),a.arcTo(150,0,24,20,20),a.lineTo(24,20),a.lineTo(-24,20),t&&a.fill(),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||1,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke()),a.beginPath(),a.fillStyle=o[1]||"#fff";var n=e.isOn?20:-20;a.arc(n,0,18,0,2*Math.PI),t&&a.fill(),a.beginPath(),a.fillStyle=o[2]||"#000",a.font="18px Kaiti",a.textAlign="center",t&&a.fillText(e.isOn?"on":"off",n,5),a.beginPath(),a.lineTo(-24,20),a.arcTo(-150,20,-24,-20,20),a.lineTo(-24,-20),a.lineTo(24,-20),a.arcTo(150,0,24,20,20),a.lineTo(24,20),a.lineTo(-24,20)}function drawFan(e,t){var a=View2d.ctx,o=nodeSetColor(e);e.offset=e.offset||0,e.offset+=e.speed||.8,a.rotate(20*e.offset*Math.PI/180);for(var n=0;n<4;n++)a.rotate(90*Math.PI/180),a.fillStyle=a.strokeStyle=o[0],a.beginPath(),a.arc(-e.params.w/2,-e.params.w/4,e.params.w/3,0,1.25*Math.PI),a.closePath(),t&&a[e.drawType]();a.fillStyle=a.strokeStyle=o[1],a.beginPath(),a.arc(0,0,e.params.w/3,0,2*Math.PI),t&&a[e.drawType](),a.beginPath(),a.arc(0,0,e.params.w,0,2*Math.PI),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||2,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke())}function windmill(e,t){e.offset=e.offset||0,e.offset+=e.speed||.2;var a=View2d.ctx,o=nodeSetColor(e);a.fillStyle=a.strokeStyle=o[2],a.beginPath(),a.rect(-3,0,6,e.params.h),t&&a[e.drawType](),a.save(),a.fillStyle=a.strokeStyle=o[0],a.rotate(10*e.offset*Math.PI/180);for(var n=0;n<3;n++)a.rotate(120*Math.PI/180),a.beginPath(),a.lineTo(-5,-5),a.lineTo(5,-5),a.lineTo(.5,-e.params.w),a.lineTo(-.5,-e.params.w),a.closePath(),t&&a[e.drawType]();a.restore(),a.fillStyle=a.strokeStyle=o[1],a.beginPath(),a.arc(0,0,8,0,2*Math.PI),t&&a[e.drawType](),a.beginPath(),a.rect(-e.params.w,-e.params.w,2*e.params.w,e.params.h+e.params.w),t&&e.border.show&&(a.lineWidth=e.border.lineWidth||2,a.strokeStyle=e.border.color||"red",a.lineCap=e.border.lineCap||"butt",a.lineJoin=e.border.lineJoin||"miter",a.setLineDash(e.border.lineDash||[0,0]),a.stroke())}function clock(e,t){var a=new Date,o=a.getMilliseconds(),n=1e3*a.getSeconds()+o,i=60*a.getMinutes()*1e3+n,r=60*a.getHours()*60*1e3+i;r>12&&(r-=432e5);var s=View2d.ctx,l=nodeSetColor(e);s.lineCap="round",s.fillStyle=s.strokeStyle=l[0],s.lineWidth=5,s.beginPath(),s.arc(0,0,e.params.w,0,2*Math.PI),t&&(s[e.drawType](),s.stroke());var c=30;s.lineWidth=3;for(var d=1;d<=12;d++)s.save(),s.textAlign="center",s.font="12px blod",s.fillStyle=s.strokeStyle=l[1],s.beginPath(),s.rotate(c*d*Math.PI/180),s.lineTo(0,-e.params.w),s.lineTo(0,18*-e.params.w/20),t&&s.stroke(),s.fillStyle=s.strokeStyle=l[2],s.translate(0,16*-e.params.w/20),s.rotate(-c*d*Math.PI/180),s.fillText(d,0,5),s.restore();var u=6;s.lineWidth=1;for(var h=1;h<=60;h++)s.fillStyle=s.strokeStyle=l[1],s.save(),s.beginPath(),s.rotate(u*h*Math.PI/180),s.lineTo(0,-e.params.w),s.lineTo(0,19*-e.params.w/20),t&&s.stroke(),s.restore();var p=30/3600/1e3;s.save(),s.fillStyle=s.strokeStyle=l[5],s.lineWidth=5,s.rotate(p*r*Math.PI/180),s.beginPath(),s.lineTo(0,5),s.lineTo(0,-e.params.w/2.5),t&&s.stroke(),s.restore();var v=1e-4;s.save(),s.fillStyle=s.strokeStyle=l[4],s.lineWidth=3,s.rotate(v*i*Math.PI/180),s.beginPath(),s.lineTo(0,5),s.lineTo(0,-e.params.w/2),t&&s.stroke(),s.restore();var f=.006;s.save(),s.fillStyle=s.strokeStyle=l[3],s.lineWidth=2,s.rotate(f*n*Math.PI/180),s.beginPath(),s.lineTo(0,5),s.lineTo(0,-e.params.w/1.5),t&&s.stroke(),s.restore(),s.fillStyle=s.strokeStyle=l[6],s.beginPath(),s.arc(0,0,3,0,2*Math.PI),t&&s.fill(),s.beginPath(),s.arc(0,0,e.params.w,0,2*Math.PI),t&&e.border.show&&(s.lineWidth=e.border.lineWidth||1,s.strokeStyle=e.border.color||"red",s.lineCap=e.border.lineCap||"butt",s.lineJoin=e.border.lineJoin||"miter",s.setLineDash(e.border.lineDash||[0,0]),s.stroke())}function light(e,t){e.offset=e.offset||0,e.isOn&&(e.offset>6&&(e.offset=0),e.offset+=e.speed||.1);var a=View2d.ctx,o=nodeSetColor(e);a.beginPath(),a.fillStyle=a.strokeStyle=o[0],a.arc(0,0,8,0,2*Math.PI),t&&a.fill(),a.fillStyle=a.strokeStyle=o[1],a.save(),a.beginPath(),a.arc(0,0,8+2*e.offset,0,2*Math.PI),t&&a.stroke(),a.restore(),a.beginPath(),a.arc(0,0,20,0,2*Math.PI)}function dom(e,t){var a=View2d.ctx;if(e.element){var o=e.position.x-e.params.w/2,n=e.position.y-e.params.h/2,i=e.rotateVal,r=e.scaleVal.x,s=e.scaleVal.y;void 0!==e.parentId&&(parent=e.findParent(),r+=r*(parent.scaleVal.x-1),s+=s*(parent.scaleVal.y-1)),e.element.style.left=o+"px",e.element.style.top=n+"px",e.element.style.pointerEvents="preview"==View2d.mode.type?"auto":"none",e.element.style.transform="rotateZ(".concat(i,"deg) scale(").concat(r,", ").concat(s,")")}var l=nodeSetColor(e);a.fillStyle=l[0],a.beginPath(),a.rect(-e.params.w/2,-e.params.h/2,e.params.w,e.params.h),t&&a.fill()}function bezierLine(e,t,a){var o=a||View2d.ctx,n=[];o.lineCap=e.lineCap||"rect";var i=nodeSetColor(e);o.fillStyle=i[1],e.linePath.forEach((function(e,t){var a=e.x,o=e.y,i=e.type||"curve";n.push({x:a,y:o,type:i})})),o.strokeStyle=i[0],_darwlinePath(n,o),t&&o[e.drawType]()}function _darwlinePath(e,t){var a=e.length;if(a<2)return!1;if(t.beginPath(),t.moveTo(e[0].x,e[0].y),2===a)t.lineTo(e[1].x,e[1].y);else{for(var o=[],n=1;n<a-1;n++)o=o.concat(_getControlpoint([e[n-1],e[n],e[n+1]]));var i=2;for("curve"==e[1].type?t.quadraticCurveTo(o[0].x,o[0].y,e[1].x,e[1].y):t.lineTo(e[1].x,e[1].y),i;i<a-1;i++)"curve"==e[i].type?t.bezierCurveTo(o[2*(i-2)+1].x,o[2*(i-2)+1].y,o[2*(i-1)].x,o[2*(i-1)].y,e[i].x,e[i].y):t.lineTo(e[i].x,e[i].y);"curve"==e[i].type?t.quadraticCurveTo(o[2*(i-2)+1].x,o[2*(i-2)+1].y,e[i].x,e[i].y):t.lineTo(e[i].x,e[i].y)}}function _getDistance(e,t){return Math.sqrt(Math.pow(e.x+t.x,2)+Math.pow(e.y+e.y,2))}function _getControlpoint(e){var t=_getDistance(e[0],e[1]),a=_getDistance(e[1],e[2]),o=t+a,n=[e[2].x-e[0].x,e[2].y-e[0].y];return[{x:e[1].x-.5*n[0]*t/o,y:e[1].y-.5*n[1]*t/o},{x:e[1].x+.5*n[0]*t/o,y:e[1].y+.5*n[1]*t/o}]}return View2d}))},"0fc5":function(e,t,a){},1692:function(e,t,a){},"1e07":function(e,t,a){"use strict";a("21d0")},"21d0":function(e,t,a){},2922:function(e,t,a){"use strict";a("1692")},"2ea5":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("63e6"),a("3aa2"),a("715c"),a("140f");var o=a("430a"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},i=[],r={},s=r,l=(a("5c0b"),a("cba8")),c=Object(l["a"])(s,n,i,!1,null,null,null),d=c.exports,u=a("7736"),h={userEquipment:{userName:"",userEquipmentGroup:[]},collapse:!1,file:{name:"",data:[]},data:{scale:1,lineName:"curve",fromArrowType:"",toArrowType:"triangleSolid",locked:0,bkColor:"",bkImage:"",grid:!0,websocket:""},resetLink:{count:0},viewData:{},event:{name:"",data:null},canvas:null,error:{text:""}},p=(a("5d63"),{emit:function(e,t){e.event=t},addView:function(e,t){e.viewData=t},change:function(e,t){e.data=t},dataScale:function(e,t){e.data.scale=t},changeFileName:function(e,t){e.file.name=t},changeBkImage:function(e,t){e.data.bkImage=t},changeBkColor:function(e,t){e.data.bkColor=t},changeGrid:function(e,t){e.data.grid=t},changeWebscoket:function(e,t){e.data.websocket=t},resetWebScoket:function(e){e.resetLink.count++},canvasChange:function(e,t){e.canvas=t},addEquipment:function(e,t){e.userEquipment.userEquipmentGroup=t},addEquipmentGroup:function(e,t){e.userEquipment.userEquipmentGroup=t}});o["default"].use(u["a"]);var v=new u["a"].Store({state:h,mutations:p}),f=v,x=(a("da02"),a("5006"),a("cd46"),a("a5e4")),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("div",{ref:"pageMenu",staticClass:"pageMenu"},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":this.$route.path,"background-color":"#545c64","text-color":"#fff","active-text-color":"#409EFF",collapse:e.collapse,router:!0},on:{select:e.onSelecte}},[a("el-menu-item",{attrs:{index:"/"}},[a("i",{staticClass:"el-icon-menu"}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("首页")])]),a("el-submenu",{attrs:{index:"0"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-s-platform"}),a("span",[e._v("设备管理")])]),a("el-menu-item",{attrs:{index:"/add-equipment"}},[e._v("添加设备")]),a("el-menu-item",{attrs:{index:"/list-equipment"}},[e._v("设备列表")])],2),a("el-menu-item",{attrs:{index:"/workspace"}},[a("i",{staticClass:"el-icon-s-tools"}),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("云组态")])])],1)],1),a("div",{staticClass:"item-page"},[a("router-view")],1)])},y=[],w={computed:{collapse:function(){return this.$store.state.collapse}},methods:{onSelecte:function(e){"/workspace"===e?(this.$store.state.collapse=!0,this.$refs.pageMenu.style.width="64px"):(this.$store.state.collapse=!1,this.$refs.pageMenu.style.width="200px")}},mounted:function(){this.onSelecte(this.$route.path)}},_=w,b=(a("c89c"),Object(l["a"])(_,m,y,!1,null,"6e43675a",null)),g=b.exports;a("6f68");o["default"].use(x["a"]);var V=[{path:"/",component:g,children:[{path:"",name:"index",component:function(){return a.e("chunk-5a6ed638").then(a.bind(null,"1e4b"))}},{path:"/add-equipment",name:"add-equipment",component:function(){return a.e("chunk-4d8a513b").then(a.bind(null,"4585"))}},{path:"/list-equipment",name:"list-equipment",component:function(){return a.e("chunk-476618f3").then(a.bind(null,"bd18"))}},{path:"/workspace",name:"workspace",component:function(){return Promise.resolve().then(a.bind(null,"6f68"))}}]},{path:"/preview",name:"preview",component:function(){return a.e("chunk-5c53cbae").then(a.bind(null,"a64c"))}}],k=new x["a"]({mode:"hash",base:"",routes:V}),N=k,P=a("82ae"),C=a.n(P),M=a("edcc"),S=a.n(M);a("0db3");o["default"].use(S.a),o["default"].config.productionTip=!1,o["default"].config.devtools=!0,o["default"].prototype.$axios=C.a,C.a.interceptors.response.use((function(e){if(e&&e.data)return e.data})),new o["default"]({router:N,store:f,render:function(e){return e(d)}}).$mount("#app")},"5c0b":function(e,t,a){"use strict";a("7df9")},"6d69":function(e,t,a){"use strict";(function(e){var o=a("9d6b");a("e186");t["a"]={data:function(){return{about:!1,license:!1,joinin:!1,lineNames:["curve","polyline","line"],arrowTypes:["","triangleSolid","triangle","diamondSolid","diamond","circleSolid","circle","line","lineUp","lineDown"],user:null}},created:function(){},computed:{scale:function(){return Math.ceil(100*this.$store.state.data.scale)},lineName:function(){return this.$store.state.data.lineName},fromArrowType:function(){return this.$store.state.data.fromArrowType},toArrowType:function(){return this.$store.state.data.toArrowType},error:function(){return this.$store.state.error}},watch:{error:function(e){this.$notify({title:"错误",type:"error",message:e.text})}},methods:{onMenu:function(e,t){if(e&&0!==e.indexOf("/"))switch(e){case"new":break;case"open":this.$store.commit("emit",{name:e});break;case"about":case"about2":this.about=!0;break;case"license":this.license=!0;break;case"joinin":this.joinin=!0;break;case"show":this.$store.commit("emit",{name:e});break;default:this.$store.commit("emit",{name:e});break}},onState:function(e,t){this.$store.commit("emit",{name:"state",data:{key:e,value:t}})},getUser:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$cookies.get("token")){t.next=4;break}return t.next=3,e.$axios.$get("/api/user/profile");case 3:e.user=t.sent;case 4:case"end":return t.stop()}}),t)})))()},onLogin:function(){e.client&&(location.href="https://account.le5le.com?cb=".concat(encodeURIComponent(location.href)))},onSignOut:function(){this.$cookies.remove("token"),this.user=null}}}}).call(this,a("eef6"))},"6f68":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page",style:"width:"+e.width},[a("div",{staticClass:"headTool"},[a("home-header")],1),a("div",{staticClass:"tools"},[a("div",{staticStyle:{display:"flex","flex-wrap":"wrap"}},e._l(e.tools,(function(t,o){return a("div",{key:o,staticClass:"item",attrs:{draggable:!0},on:{dragstart:function(a){return e.onDrag(a,t.node)}}},[a("p",[e._v(e._s(t.name))])])})),0)]),a("div",{staticClass:"full",attrs:{id:"view2d-canvas"},on:{click:e.onClickBlank,drop:e.getData,dragover:function(e){e.preventDefault()},contextmenu:function(t){return e.onContextMenu(t)}}},[e.contextmenu.left?a("div",{staticClass:"context-menu",style:this.contextmenu},[a("CanvasContextMenu",{attrs:{Node:e.Node,scene:e.scene},on:{closeMenu:function(t){e.contextmenu.left=null},update:e.updateNode,"update:Node":function(t){e.Node=t},"update:node":function(t){e.Node=t}}})],1):e._e()]),a("div",{staticClass:"props",style:e.props.expand?"overflow: visible":""},[a("CanvasProps",{attrs:{Node:e.Node,name:e.topoName},on:{"update:name":function(t){e.topoName=t},change:e.onUpdateProps}})],1),a("el-dialog",{attrs:{title:"新建组态",visible:e.topoShow,width:"25%"},on:{"update:visible":function(t){e.topoShow=t}}},[a("div",{staticClass:"topoName"},[a("span",{staticClass:"nameLabel"},[e._v("组态名称：")]),a("el-input",{attrs:{placeholder:"请输入设备组名称",size:"small"},model:{value:e.topoName,callback:function(t){e.topoName=t},expression:"topoName"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.topoShow=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.onCreateTopo}},[e._v("确定")])],1)])],1)},n=[],i=a("b8c7"),r=a("d399"),s=(a("5d63"),a("61d9"),a("4822"),a("da02"),a("5006"),a("cd46"),a("9dd2"),a("f667"),a("0a59")),l=a.n(s),c=[{name:"矩形水容器",node:{shape:"waterCapacity",drawType:"fill",lineWidth:1,isOn:!0,speed:.2,waterHeight:.5,color:["rgba(21,115,151,0.5)","#2cafe7"],linePath:[{x:-50,y:-50},{x:50,y:-50},{x:50,y:50},{x:-50,y:50}]}},{name:"水容器",node:{shape:"waterCapacity",drawType:"stroke",lineWidth:1,isOn:!0,text:{content:"50%"},speed:.2,waterHeight:.5,color:["rgba(21,115,151,0.5)","#2cafe7"],linePath:[]}},{name:"水管",node:{shape:"channel",drawType:"fill",lineWidth:20,isOn:!0,speed:.2,color:["rgba(21,115,151,0.5)","#2cafe7"],linePath:[]}},{name:"曲线",node:{shape:"bezierLine",drawType:"stroke",lineWidth:1,linePath:[]}},{name:"圆",node:{shape:"arc",drawType:"fill",text:{content:"圆"},color:["#2cafe7"],lineWidth:1,params:{r:50,start:0,end:2*Math.PI},position:{x:0,y:0}}},{name:"矩形",node:{shape:"rect",drawType:"fill",lineWidth:2,color:["#2cafe7"],text:{content:"呜呼！楚虽三户能亡秦，岂有堂堂中国空无人！",padding:[0,0],color:"",fontSize:18,fontFamily:"",fontStyle:"italic",textAlign:"center",textVertical:"top",textShadowColor:"#000",textShadowBlur:3,textShadowOffsetX:2,textShadowOffsetY:2},params:{w:100,h:100},position:{x:0,y:0}}},{name:"三角形",node:{shape:"polygon",drawType:"fill",color:["#2cafe7"],lineWidth:1,params:{w:50,h:50,num:3},position:{x:0,y:0}}},{name:"菱形",node:{shape:"polygon",drawType:"fill",color:["#2cafe7"],lineWidth:1,params:{w:50,h:50,num:4},position:{x:0,y:0}}},{name:"五边形",node:{shape:"polygon",drawType:"fill",color:["#2cafe7"],text:{content:"五边形"},border:{show:!0,color:"red",lineWidth:1,lineCap:"square",lineJoin:"round"},lineWidth:1,params:{w:50,h:50,num:5},position:{x:0,y:0}}},{name:"八边形",node:{shape:"polygon",drawType:"fill",color:["#2cafe7"],lineWidth:1,text:{content:"八边形"},params:{w:50,h:50,num:8},position:{x:0,y:0}}},{name:"五角星",node:{shape:"fivePointedStart",drawType:"fill",color:["#2cafe7"],params:{size:50},position:{x:0,y:0}}},{name:"闪灯",icon:"",node:{shape:"light",drawType:"fill",isOn:!0,speed:.05,color:["#ff0000","#ff0000"],position:{x:0,y:0}}},{name:"钟表",icon:"",node:{shape:"clock",drawType:"stroke",isOn:!0,color:["#000","#fff","#fff","red","#fff","#fff","red"],params:{w:100,h:150},position:{x:0,y:0}}},{name:"大风车",node:{shape:"windmill",color:["#ccc","#2cafe7","#eee"],drawType:"stroke",speed:.1,params:{w:80,h:150},position:{x:0,y:0}}},{name:"视频",node:{shape:"drawVideo",drawType:"fill",isOn:!1,src:"./img/mov_bbb.mp4",params:{w:150,h:100},position:{x:0,y:0}}},{name:"图片",node:{shape:"drawImage",drawType:"fill",src:"http://file.trump.kexsci.com/kexsci/images/1629163005446微信图片_20210817091134.png",color:["rgba(0,0,0,0)"],params:{w:150,h:100},position:{x:0,y:0}}},{name:"文本",node:{shape:"drawText",text:{content:"文本内容"},color:["#2cafe7","#fff"],params:{w:150,h:100},position:{x:0,y:0}}},{name:"元素",node:{shape:"dom",color:["orange"],params:{w:150,h:100},position:{x:0,y:0}}},{name:"折线图",node:{shape:"drawEcharts",color:["#fff"],params:{w:300,h:200},echartsOption:{color:["#409EFF"],tooltip:{trigger:"axis"},xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[820,932,901,934,1290,1330,1320],type:"line",smooth:!0}]},position:{x:0,y:0}}},{name:"柱状图",node:{shape:"drawEcharts",color:["#fff"],params:{w:300,h:200},echartsOption:{color:["#409EFF"],tooltip:{trigger:"axis"},xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]},yAxis:{type:"value"},series:[{data:[120,200,150,80,70,110,130],type:"bar"}]},position:{x:0,y:0}}},{name:"雷达图",node:{shape:"drawEcharts",color:["#fff"],params:{w:300,h:200},echartsOption:{title:{text:"基础雷达图"},legend:{data:["预算分配（Allocated Budget）","实际开销（Actual Spending）"]},radar:{indicator:[{name:"销售（Sales）",max:6500},{name:"管理（Administration）",max:16e3},{name:"信息技术（Information Technology）",max:3e4},{name:"客服（Customer Support）",max:38e3},{name:"研发（Development）",max:52e3},{name:"市场（Marketing）",max:25e3}]},series:[{name:"预算 vs 开销（Budget vs spending）",type:"radar",data:[{value:[4200,3e3,2e4,35e3,5e4,18e3],name:"预算分配（Allocated Budget）"},{value:[5e3,14e3,28e3,26e3,42e3,21e3],name:"实际开销（Actual Spending）"}]}]},position:{x:0,y:0}}},{name:"饼图",node:{shape:"drawEcharts",color:["#fff"],params:{w:300,h:200},echartsOption:{title:{text:"某站点用户访问来源",subtext:"纯属虚构",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{name:"访问来源",type:"pie",radius:"50%",data:[{value:1048,name:"搜索引擎"},{value:735,name:"直接访问"},{value:580,name:"邮件营销"},{value:484,name:"联盟广告"},{value:300,name:"视频广告"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},position:{x:0,y:0}}},{name:"环形图",node:{shape:"drawEcharts",color:["#fff"],params:{w:300,h:200},echartsOption:{tooltip:{trigger:"item"},legend:{top:"5%",left:"center"},series:[{name:"访问来源",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:1048,name:"搜索引擎"},{value:735,name:"直接访问"},{value:580,name:"邮件营销"},{value:484,name:"联盟广告"},{value:300,name:"视频广告"}]}]},position:{x:0,y:0}}},{name:"仪表盘",node:{shape:"drawEcharts",color:["#fff"],params:{w:300,h:200},echartsOption:{tooltip:{formatter:"{a} <br/>{b} : {c}%"},toolbox:{feature:{restore:{},saveAsImage:{}}},series:[{name:"业务指标",type:"gauge",detail:{formatter:"{value}%"},data:[{value:50,name:"完成率"}]}]},position:{x:0,y:0}}},{name:"风扇",node:{shape:"drawFan",drawType:"fill",color:["#2cafe7","#fff"],speed:.3,params:{w:80,h:80},position:{x:0,y:0}}},{name:"开关",node:{shape:"drawSwitch",color:["red","#fff","#ccc"],isOn:!0,position:{x:0,y:0}}}],d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.Node?a("div",[a("el-tabs",{attrs:{stretch:!0},on:{"tab-click":e.initData},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"显示设置",name:"first"}},[a("div",{staticClass:"itemBox"},["node"==e.Node.type?a("div",[a("div",{staticClass:"title"},[e._v("背景和边框")]),a("div",{staticClass:"items flex column"},[a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("绘制方式:")]),a("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:e.Node.drawType,callback:function(t){e.$set(e.Node,"drawType",t)},expression:"Node.drawType"}},e._l([{label:"填充",value:"fill"},{label:"轮廓",value:"stroke"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("背景颜色:")]),e._l(e.Node.color,(function(t,o){return a("el-popover",{key:o,attrs:{placement:"bottom",width:"230"},on:{show:function(t){return e.openSelected(o)}},model:{value:e.showSelectedColor[o],callback:function(t){e.$set(e.showSelectedColor,o,t)},expression:"showSelectedColor[i]"}},[a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("背景类型:")]),a("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.selectedType(o)}},model:{value:e.backgroundType,callback:function(t){e.backgroundType=t},expression:"backgroundType"}},e._l([{label:"单色背景",value:0},{label:"线性渐变背景",value:1},{label:"径向渐变背景",value:2}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"string"==typeof t&&e.showSelectedColor[o]?a("div",{directives:[{name:"show",rawName:"v-show",value:0==e.backgroundType,expression:"backgroundType == 0"}],staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("背景颜色:")]),a("el-color-picker",{attrs:{"show-alpha":"",size:"small"},on:{change:e.onChangeColor},model:{value:e.Node.color[o],callback:function(t){e.$set(e.Node.color,o,t)},expression:"Node.color[i]"}})],1):e._e(),"object"==typeof t&&e.showSelectedColor[o]?a("div",{directives:[{name:"show",rawName:"v-show",value:0!==e.backgroundType,expression:"backgroundType !== 0"}]},[a("div",{staticClass:"flex middle"},[a("span",[e._v("渐变分向：")]),1==e.backgroundType?a("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.Node.color[o].direction,callback:function(t){e.$set(e.Node.color[o],"direction",t)},expression:"Node.color[i].direction"}},e._l([{label:"水平渐变",value:"to right"},{label:"垂直渐变",value:"to bottom"},{label:"左上到右下",value:"135deg"},{label:"左下到右上",value:"45deg"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):a("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.Node.color[o].direction,callback:function(t){e.$set(e.Node.color[o],"direction",t)},expression:"Node.color[i].direction"}},e._l([{label:"中心渐变",value:"center"},{label:"顶部渐变",value:"top"},{label:"底部渐变",value:"bottom"},{label:"左侧渐变",value:"left"},{label:"右侧渐变",value:"right"}],(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("div",{staticClass:"flex middle"},[a("span",[e._v("开始颜色：")]),a("el-color-picker",{attrs:{"show-alpha":"",size:"small"},model:{value:e.Node.color[o].gradient[0],callback:function(t){e.$set(e.Node.color[o].gradient,0,t)},expression:"Node.color[i].gradient[0]"}}),a("span",[e._v("结束颜色：")]),a("el-color-picker",{attrs:{"show-alpha":"",size:"small"},model:{value:e.Node.color[o].gradient[1],callback:function(t){e.$set(e.Node.color[o].gradient,1,t)},expression:"Node.color[i].gradient[1]"}})],1)]):e._e(),"string"==typeof t?a("span",{staticClass:"color-ball",style:"background:"+t,attrs:{slot:"reference"},slot:"reference"}):e._e(),"object"==typeof t&&"linear"==t.type?a("span",{staticClass:"color-ball",style:"background:"+t.type+"-gradient("+t.direction+","+t.gradient[0]+","+t.gradient[1],attrs:{slot:"reference"},slot:"reference"}):e._e(),"object"==typeof t&&"radial"==t.type?a("span",{staticClass:"color-ball",style:"background:"+t.type+"-gradient("+t.gradient[0]+","+t.gradient[1],attrs:{slot:"reference"},slot:"reference"}):e._e()])}))],2),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("边框显示:")]),a("el-switch",{attrs:{"active-color":"#13ce66","inactive-colori":"#ccc","active-value":!0,"inactive-value":!1},model:{value:e.Node.border.show,callback:function(t){e.$set(e.Node.border,"show",t)},expression:"Node.border.show"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.Node.border.show,expression:"Node.border.show"}]},[a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("边框颜色:")]),a("el-color-picker",{attrs:{"show-alpha":"",size:"small"},model:{value:e.Node.border.color,callback:function(t){e.$set(e.Node.border,"color",t)},expression:"Node.border.color"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("边框宽度:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{min:1,"controls-position":"right",size:"small"},model:{value:e.Node.border.lineWidth,callback:function(t){e.$set(e.Node.border,"lineWidth",t)},expression:"Node.border.lineWidth"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("线条样式:")]),a("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:e.lineDashChange},model:{value:e.lineDash,callback:function(t){e.lineDash=t},expression:"lineDash"}},e._l(e.lineOption,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("阴影颜色:")]),a("el-color-picker",{attrs:{"show-alpha":"",size:"small"},model:{value:e.Node.shadowColor,callback:function(t){e.$set(e.Node,"shadowColor",t)},expression:"Node.shadowColor"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("阴影大小:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{min:0,"controls-position":"right",size:"small"},model:{value:e.Node.shadowBlur,callback:function(t){e.$set(e.Node,"shadowBlur",t)},expression:"Node.shadowBlur"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("阴影X偏移:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{"controls-position":"right",size:"small"},model:{value:e.Node.shadowOffsetX,callback:function(t){e.$set(e.Node,"shadowOffsetX",t)},expression:"Node.shadowOffsetX"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("阴影Y偏移:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{"controls-position":"right",size:"small"},model:{value:e.Node.shadowOffsetY,callback:function(t){e.$set(e.Node,"shadowOffsetY",t)},expression:"Node.shadowOffsetY"}})],1)])]):e._e(),a("div",{staticClass:"title"},[e._v("位置和变换")]),a("div",{staticClass:"flex column mt5 mb5"},[a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("X坐标:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{"controls-position":"right",size:"small"},on:{change:function(t){return e.Node.translate(e.position)}},model:{value:e.position.x,callback:function(t){e.$set(e.position,"x",t)},expression:"position.x"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("Y坐标:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{"controls-position":"right",size:"small"},on:{change:function(t){return e.Node.translate(e.position)}},model:{value:e.position.y,callback:function(t){e.$set(e.position,"y",t)},expression:"position.y"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("X缩放:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{"controls-position":"right",step:.1,min:.1,size:"small"},on:{change:function(t){return e.Node.scale(e.scaleVal.x,e.scaleVal.y)}},model:{value:e.scaleVal.x,callback:function(t){e.$set(e.scaleVal,"x",t)},expression:"scaleVal.x"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("Y缩放:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{"controls-position":"right",step:.1,min:.1,size:"small"},on:{change:function(t){return e.Node.scale(e.scaleVal.x,e.scaleVal.y)}},model:{value:e.scaleVal.y,callback:function(t){e.$set(e.scaleVal,"y",t)},expression:"scaleVal.y"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""},domProps:{innerHTML:e._s("&ensp;旋转:")}}),a("el-input-number",{staticStyle:{flex:"1"},attrs:{"controls-position":"right",size:"small"},on:{change:function(t){return e.Node.rotate(e.rotateVal)}},model:{value:e.rotateVal,callback:function(t){e.rotateVal=t},expression:"rotateVal"}})],1)])]),"node"==e.Node.type?a("div",{staticClass:"itemBox"},[a("div",{staticClass:"title"},[e._v("文本样式")]),a("div",{staticClass:"flex column mt5 mb5"},[a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""},domProps:{innerHTML:e._s("内&emsp;&emsp;容:")}}),a("el-input",{staticStyle:{flex:"1"},attrs:{clearable:"",size:"small"},model:{value:e.Node.text.content,callback:function(t){e.$set(e.Node.text,"content",t)},expression:"Node.text.content"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("字体颜色:")]),a("el-color-picker",{attrs:{"show-alpha":"",size:"small"},model:{value:e.Node.text.color,callback:function(t){e.$set(e.Node.text,"color",t)},expression:"Node.text.color"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("字体大小:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{min:12,"controls-position":"right",size:"small"},model:{value:e.Node.text.fontSize,callback:function(t){e.$set(e.Node.text,"fontSize",t)},expression:"Node.text.fontSize"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("字体粗细:")]),a("el-select",{staticClass:"select",attrs:{"value-key":"value",size:"small",placeholder:"选择设备组"},model:{value:e.Node.text.fontWeight,callback:function(t){e.$set(e.Node.text,"fontWeight",t)},expression:"Node.text.fontWeight"}},e._l(e.weightOption,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1)],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("字体风格:")]),a("el-select",{staticClass:"select",attrs:{"value-key":"value",size:"small",placeholder:"选择设备组"},model:{value:e.Node.text.fontStyle,callback:function(t){e.$set(e.Node.text,"fontStyle",t)},expression:"Node.text.fontStyle"}},e._l(e.fontStyleOption,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1)],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("水平对齐:")]),a("el-select",{staticClass:"select",attrs:{"value-key":"value",size:"small",placeholder:"选择设备组"},model:{value:e.Node.text.textAlign,callback:function(t){e.$set(e.Node.text,"textAlign",t)},expression:"Node.text.textAlign"}},e._l(e.textAlignOption,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1)],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("垂直对齐:")]),a("el-select",{staticClass:"select",attrs:{"value-key":"value",size:"small",placeholder:"选择设备组"},model:{value:e.Node.text.textVertical,callback:function(t){e.$set(e.Node.text,"textVertical",t)},expression:"Node.text.textVertical"}},e._l(e.textVerticalOption,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1)],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("水平边距:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{min:0,"controls-position":"right",size:"small"},model:{value:e.Node.text.padding[1],callback:function(t){e.$set(e.Node.text.padding,1,t)},expression:"Node.text.padding[1]"}})],1),a("div",{staticClass:"flex middle mb5"},[a("label",{staticClass:"ml5 mr5",attrs:{for:""}},[e._v("垂直边距:")]),a("el-input-number",{staticStyle:{flex:"1"},attrs:{min:0,"controls-position":"right",size:"small"},model:{value:e.Node.text.padding[0],callback:function(t){e.$set(e.Node.text.padding,0,t)},expression:"Node.text.padding[0]"}})],1)])]):e._e()]),a("el-tab-pane",{attrs:{label:"数据连接",name:"second"}},[a("div",{staticClass:"flex justify-around mt5 mb10"},[a("label",{staticClass:"ml5"},[e._v("设备组:")]),a("div",{staticClass:"flex mb10"},[a("el-select",{staticClass:"select",attrs:{"value-key":"value",size:"small",placeholder:"选择设备组"},model:{value:e.equipment,callback:function(t){e.equipment=t},expression:"equipment"}},e._l(e.group,(function(e,t){return a("el-option",{key:t,attrs:{value:e.equipmentList,label:e.groupName}})})),1)],1)]),a("div",{staticClass:"flex justify-around mt5 mb10"},[a("label",{staticClass:"ml5"},[e._v("设备:")]),a("div",{staticClass:"flex mb10"},[a("el-select",{staticClass:"select",attrs:{disabled:!e.equipment.length,size:"small",placeholder:"请先选择设备组"},model:{value:e.sensor,callback:function(t){e.sensor=t},expression:"sensor"}},e._l(e.equipment,(function(e,t){return a("el-option",{key:t,attrs:{value:e.sensorList,label:e.equipmentName}})})),1)],1)]),a("div",{staticClass:"border-bottom flex justify-around mt5 mb10"},[a("label",{staticClass:"ml5"},[e._v("传感器:")]),a("div",{staticClass:"flex mb10"},[a("el-select",{staticClass:"select",attrs:{disabled:!e.sensor.length,size:"small",placeholder:"请先选择设备"},model:{value:e.selectedSensor,callback:function(t){e.selectedSensor=t},expression:"selectedSensor"}},e._l(e.sensor,(function(e,t){return a("el-option",{key:t,attrs:{value:e.name,label:e.name}})})),1)],1)]),a("div",{staticClass:"flex justify-around mt10 mb10 "},[a("label",{staticClass:"ml5"},[e._v("类型设置:")]),a("div",{staticClass:"flex mb10"},[a("el-select",{staticClass:"select",attrs:{size:"small"},on:{change:e.onSelectedSensor},model:{value:e.selectedSensorType,callback:function(t){e.selectedSensorType=t},expression:"selectedSensorType"}},e._l(e.typeOption,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.text}})})),1)],1)]),a("div",{staticClass:"flex justify-around mt10 mb10"},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"small"},on:{click:e.onLinkSensor}},[e._v("确定连接")])],1)]),a("el-tab-pane",{attrs:{label:"事件",name:"third"}},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.Node.events.push({params:{}})}}},[e._v("添加事件")]),e._l(e.Node.events,(function(t,o){return a("div",{key:o,staticClass:" flex column"},[a("h3",{staticClass:"border-bottom pv10"},[a("span",{staticClass:"mr15"},[e._v("事件")]),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(t){return e.Node.events.splice(o,1)}}})],1),a("div",{staticClass:"mb10"},[a("label",[e._v("事件类型：")]),a("el-select",{attrs:{size:"mini"},on:{change:function(a){return e.onSelectEventDo(t,o)}},model:{value:t.events,callback:function(a){e.$set(t,"events",a)},expression:"item.events"}},[a("el-option",{attrs:{value:"click",label:"点击事件"}}),a("el-option",{attrs:{value:"dblclick",label:"双击事件"}}),a("el-option",{attrs:{value:"hover",label:"鼠标hover事件"}})],1)],1),a("div",{staticClass:"mb10"},[a("label",[e._v("事件行为：")]),a("el-select",{attrs:{size:"mini"},on:{change:function(a){return e.onSelectEventDo(t,o)}},model:{value:t.params.type,callback:function(a){e.$set(t.params,"type",a)},expression:"item.params.type"}},[a("el-option",{attrs:{value:0,label:"打开链接"}}),a("el-option",{attrs:{value:1,label:"节点联动"}}),a("el-option",{attrs:{value:2,label:"执行自定义js代码"}}),a("el-option",{attrs:{value:3,label:"ajax异步请求"}})],1)],1),3==t.params.type?a("div",{staticClass:" flex column mt10"},[a("h3",{staticClass:"ml5 mt5 mb10 border-bottom"},[e._v("自定义接口API")]),a("div",[a("label",{staticClass:"ml5 mt5 mb10"},[e._v("API地址:")]),a("el-input",{staticClass:"mb10",attrs:{placeholder:"例如：http//www.xxxxx.com/api...",size:"small"},on:{change:function(a){return e.onSelectEventDo(t,o)}},model:{value:t.params.APIUrl,callback:function(a){e.$set(t.params,"APIUrl",a)},expression:"item.params.APIUrl"}})],1),a("div",[a("label",{staticClass:"ml5 mt5 mb10"},[e._v("请求类型"+e._s(t.params.APIType)+":")]),a("div",{staticClass:"flex mb10"},[a("el-select",{staticClass:"mr5",attrs:{size:"small"},on:{change:function(a){return e.onSelectEventDo(t,o)}},model:{value:t.params.APIType,callback:function(a){e.$set(t.params,"APIType",a)},expression:"item.params.APIType"}},[a("el-option",{attrs:{value:"get",label:"get"}}),a("el-option",{attrs:{value:"post",label:"post"}})],1)],1)]),a("div",[a("label",{staticClass:"ml5 mt5 mb10"},[e._v("请求参数:")]),a("div",{staticClass:"flex mb10"},[a("el-input",{staticClass:"mr5",attrs:{type:"textArea",rows:5,placeholder:"例如：{pmId: 10}",size:"small"},on:{change:function(a){return e.onSelectEventDo(t,o)}},model:{value:t.params.APIParams,callback:function(a){e.$set(t.params,"APIParams",a)},expression:"item.params.APIParams"}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.onLinkAPI(e.Node,t)}}},[e._v("查看接口数据")])],1)]),e.Node.data?a("div"):e._e(),a("div",[a("label",{staticClass:"ml5 mt5 mb10"},[e._v("绑定哪个字段:")]),a("div",{staticClass:"flex gird"},[a("el-input",{staticClass:"mr5",attrs:{placeholder:"例如：data.name",size:"small"},on:{change:function(a){return e.onSelectEventDo(t,o)}},model:{value:t.params.bindValue,callback:function(a){e.$set(t.params,"bindValue",a)},expression:"item.params.bindValue"}})],1)])]):a("div",[a("div",{staticClass:"mb10"},[0==t.params.type?a("label",[e._v("链接地址：")]):e._e(),1==t.params.type?a("label",[e._v("动画标签：")]):e._e(),2==t.params.type?a("label",[e._v("自定js代码：")]):e._e(),3==t.params.ype?a("label",[e._v("自定义函数：")]):e._e(),1!=t.type?a("el-input",{staticClass:"mb5",attrs:{type:"textarea",rows:2==t.params.type||3==t.params.type?15:1},on:{change:function(a){return e.onSelectEventDo(t,o)}},model:{value:t.params.value,callback:function(a){e.$set(t.params,"value",a)},expression:"item.params.value"}}):a("el-select",{attrs:{size:"mini"},on:{change:function(t){return e.flash_animation(e.Node)}},model:{value:e.animation,callback:function(t){e.animation=t},expression:"animation"}},[a("el-option",{attrs:{value:"0",label:"动画1"}}),a("el-option",{attrs:{value:"1",label:"动画2"}})],1)],1)])])}))],2)],1)],1):a("div",[a("div",{staticClass:"title"},[e._v("基本设置")]),a("div",{staticClass:"ph20 flex mt10"},[a("label",{staticClass:"mr5"},[e._v("图文名称:")]),a("el-input",{attrs:{size:"small"},on:{change:e.onChangeFileName},model:{value:e.fileName,callback:function(t){e.fileName=t},expression:"fileName"}})],1),a("div",{staticClass:"ph20 flex mt10"},[a("label",{staticClass:"mr5"},[e._v("背景颜色:")]),a("el-input",{attrs:{size:"small"},on:{change:e.onChangeColor},model:{value:e.bgColor,callback:function(t){e.bgColor=t},expression:"bgColor"}}),a("el-color-picker",{attrs:{size:"small"},on:{change:e.onChangeColor},model:{value:e.bgColor,callback:function(t){e.bgColor=t},expression:"bgColor"}})],1),a("div",{staticClass:"ph20 flex mt10"},[a("label",{staticClass:"mr5"},[e._v("背景图片:")]),a("el-button",{attrs:{type:"info",size:"mini",plain:"",round:""},on:{click:function(t){t.stopPropagation(),e.chooseBgImg=!0}}},[a("i",{staticClass:"el-icon-picture-outline"})]),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:e.onDeleBgImg}}),a("el-dialog",{attrs:{title:"选择背景图片",visible:e.chooseBgImg},on:{"update:visible":function(t){e.chooseBgImg=t}}},[a("div",{staticClass:"bgImg"},e._l(e.bgList,(function(t,o){return a("div",{key:o,staticClass:"bgImgItem",on:{click:function(t){return e.onSelectedImg(o)}}},[a("el-image",{staticStyle:{height:"160px"},attrs:{src:t.url,fit:"cover"}}),a("span",[e._v(e._s(t.name))])],1)})),0)])],1),a("div",{staticClass:"ph20 flex mt10"},[a("label",{staticClass:"mr5"},[e._v("背景网格:")]),a("el-switch",{attrs:{"active-color":"#13ce66","inactive-colori":"#ccc","active-value":!0,"inactive-value":!1},on:{change:e.changeGrid},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)])])},u=[],h=a("c868"),p=h["a"],v=(a("8324"),a("cba8")),f=Object(v["a"])(p,d,u,!1,null,"90b73402",null),x=f.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"menus",on:{click:function(t){return e.$emit("closeMenu")}}},[a("div",[a("a",{class:{disabled:e.Node.freeze},on:{click:function(t){return e.onTop()}}},[e._v("置顶")])]),a("div",[a("a",{class:{disabled:e.Node.freeze},on:{click:function(t){return e.onBottom()}}},[e._v("置底")])]),a("div",{staticClass:"line"}),a("div",[a("a",{on:{click:function(t){e.Node.freeze=!e.Node.freeze}}},[e._v(e._s(e.Node.freeze?"解冻":"冻结"))])]),a("div",[a("a",{class:{disabled:e.Node.freeze},on:{click:function(t){return e.del()}}},[e._v("删除")])]),a("div",{directives:[{name:"show",rawName:"v-show",value:"node"!==e.Node.type,expression:"Node.type!=='node'"}],staticClass:"line"}),a("div",{directives:[{name:"show",rawName:"v-show",value:"node"!==e.Node.type,expression:"Node.type!=='node'"}]},[a("a",{class:{disabled:e.Node.freeze},on:{click:function(t){return e.onCombine()}}},[e._v(e._s("extraGroup"==e.Node.type?"组合":"取消组合"))])]),a("div",{staticClass:"line"}),a("div",[a("a",{staticClass:"flex",class:{disabled:e.Node.freeze},on:{click:function(t){return e.clone()}}},[a("span",{staticClass:"full"},[e._v("克隆")])])])])},y=[],w=(a("dc87"),{data:function(){return{}},props:{scene:{type:Object,require:!0},Node:{type:Object,require:!0}},methods:{onTop:function(){var e=this.scene.children.sort((function(e,t){return t.zIndex-e.zIndex}))[0].zIndex;this.Node.zIndex=e+1},onBottom:function(){var e=this.scene.children.sort((function(e,t){return e.zIndex-t.zIndex}))[0].zIndex;this.Node.zIndex=e-1},del:function(){this.scene.remove(this.Node)},clone:function(){var e=this.Node.clone(),t=e.position,a=t.x,o=t.y;this.scene.add(e),e.translate({x:a+10,y:o+10}),this.$emit("update",e)},onCombine:function(){"extraGroup"==this.Node.type?this.Node.combine():this.Node.unCombine()},onCopyImage:function(){this.scene.toImage({})}}}),_=w,b=(a("7110"),Object(v["a"])(_,m,y,!1,null,null,null)),g=b.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"headers"},[a("el-menu",{staticClass:"menu",attrs:{mode:"horizontal","active-text-color":"#409EFF","background-color":"#545c64","text-color":"#fff"},on:{select:e.onMenu}},[a("el-menu-item",{staticClass:"logo"},[a("router-link",{attrs:{to:"/"}},[a("img",{attrs:{src:"/favicon.ico"}})])],1),a("el-submenu",{attrs:{index:"file"}},[a("template",{slot:"title"},[e._v("文件")]),a("el-menu-item",{attrs:{index:"open"}},[e._v("打开本地文件（新建）")]),a("el-menu-item",{attrs:{index:"replace"}},[e._v("导入本地文件...")]),a("el-menu-item",{staticClass:"separator"},[e._v("-------------------------------")]),a("el-menu-item",{attrs:{index:"save"}},[e._v("保存到本地")]),a("el-menu-item",{attrs:{index:"savePng"}},[e._v("下载为PNG")]),a("el-menu-item",{attrs:{index:"saveSvg"}},[e._v("下载为SVG")])],2),a("el-submenu",{attrs:{index:"edit"}},[a("template",{slot:"title"},[e._v("编辑")]),a("el-menu-item",{attrs:{index:"undo"}},[e._v("撤消")]),a("el-menu-item",{attrs:{index:"redo"}},[e._v("重做")]),a("el-menu-item",{staticClass:"separator"},[e._v("-------------------------------")]),a("el-menu-item",{attrs:{index:"copy"}},[e._v("复制")]),a("el-menu-item",{attrs:{index:"cut"}},[e._v("剪切")]),a("el-menu-item",{attrs:{index:"paste"}},[e._v("粘贴")])],2),a("el-submenu",{attrs:{index:"share"}},[a("template",{slot:"title"},[e._v("社区")]),a("el-menu-item",{attrs:{index:"about"}},[e._v("咨询与建议")]),a("el-menu-item",[a("a",{attrs:{href:"https://github.com/le5le-com",target:"_blank"}},[e._v("开源Github")])]),a("el-menu-item",[a("a",{attrs:{href:"https://www.yuque.com/alsmile/topology",target:"_blank"}},[e._v("开发文档")])])],2),a("el-submenu",{attrs:{index:"help"}},[a("template",{slot:"title"},[e._v("帮助")]),a("el-menu-item",[a("a",{attrs:{href:"http://topology.le5le.com",target:"_blank"}},[e._v("在线官网")])]),a("el-menu-item",{attrs:{index:"license"}},[e._v("许可与申明")]),a("el-menu-item",{attrs:{index:"joinin"}},[e._v("资助与加入")]),a("el-menu-item",{attrs:{index:"about2"}},[e._v("关于")])],2)],1),a("el-menu",{staticClass:"full",attrs:{mode:"horizontal","background-color":"#545c64","text-color":"#fff"}}),a("el-menu",{attrs:{mode:"horizontal","background-color":"#545c64","active-text-color":"#409EFF","text-color":"#fff"},on:{select:e.onMenu}},[a("el-menu-item",{attrs:{index:"show"}},[a("i",{staticClass:"el-icon-video-play"}),a("span",[e._v("预览")])]),a("el-menu-item",[e._v("视图比例："+e._s(e.scale)+"% （Ctrl+鼠标滚轮）")]),a("el-submenu",{attrs:{index:"state",title:"默认连线类型"}},[a("template",{slot:"title"},[a("i",{class:"iconfont icon-"+e.lineName})]),e._l(e.lineNames,(function(t,o){return a("el-menu-item",{key:o,attrs:{index:"line-"+t},on:{click:function(a){return e.onState("lineName",t)}}},[a("i",{class:"iconfont icon-"+t})])}))],2)],1),a("el-menu",{attrs:{mode:"horizontal","background-color":"#545c64","active-text-color":"#409EFF","text-color":"#fff"}},[a("el-submenu",{attrs:{index:"state",title:"默认起点箭头"}},[a("template",{slot:"title"},[a("i",{class:"iconfont icon-from-"+e.fromArrowType})]),e._l(e.arrowTypes,(function(t,o){return a("el-menu-item",{key:o,attrs:{index:"fromArrow-"+t},on:{click:function(a){return e.onState("fromArrowType",t)}}},[a("i",{class:"iconfont icon-from-"+t})])}))],2)],1),a("el-menu",{attrs:{mode:"horizontal","background-color":"#545c64","active-text-color":"#409EFF","text-color":"#fff"}},[a("el-submenu",{attrs:{index:"state",title:"默认终点箭头"}},[a("template",{slot:"title"},[a("i",{class:"iconfont icon-to-"+e.toArrowType})]),e._l(e.arrowTypes,(function(t,o){return a("el-menu-item",{key:o,attrs:{index:"toArrow-"+t},on:{click:function(a){return e.onState("toArrowType",t)}}},[a("i",{class:"iconfont icon-to-"+t})])}))],2)],1),a("el-menu",{attrs:{mode:"horizontal","background-color":"#545c64","active-text-color":"#409EFF","text-color":"#fff"}},[e.user?a("el-submenu",{attrs:{index:"user"}},[a("template",{slot:"title"},[a("el-avatar",{attrs:{src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png",size:24}}),e._v(" "+e._s(e.user.username)+" ")],1),a("el-menu-item",{on:{click:e.onSignOut}},[e._v("退出")])],2):e._e(),e.user?e._e():a("el-menu-item")],1)],1)},k=[],N=a("6d69"),P=N["a"],C=(a("2922"),Object(v["a"])(P,V,k,!1,null,null,null)),M=C.exports,S=(a("2ea5"),a("82ae")),E=a.n(S),I={data:function(){return{tools:c,animationId:null,canvas:null,scene:null,topoShow:!1,topoName:"1231",darwLine:!1,props:{node:null,line:null,nodes:null,multi:!1,expand:!1,locked:!1},Node:null,contextmenu:{left:null,top:null,bottom:null},lastTime:0}},components:{CanvasProps:x,CanvasContextMenu:g,HomeHeader:M},computed:{width:function(){return this.$store.state.collapse?"calc(100vw - 64px)":"calc(100vw - 200px)"},event:function(){return this.$store.state.event},bkImage:function(){return this.$store.state.data.bkImage},bkColor:function(){return this.$store.state.data.bkColor},grid:function(){return this.$store.state.data.grid},websocket:function(){return this.$store.state.resetLink.count},changeNode:function(){return l.a.activeNode.name}},watch:{event:function(e){if(this["handle_"+e.name]){var t=l.a.getData();this["handle_"+e.name](t)}},grid:function(e){l.a.grid.show=e},bkImage:function(e){l.a.background.image=e},bkColor:function(e){l.a.background.color=e},websocket:function(){this.$store.state.data.websocket&&(this.canvas.data.websocket=this.$store.state.data.websocket,this.canvas.render())},$route:function(e){this.open()}},created:function(){this.$store.commit("changeGrid",l.a.grid.show),this.$store.commit("changeBkColor",l.a.background.color),this.$store.commit("changeBkImage",l.a.background.image)},methods:{onDrag:function(e,t){e.dataTransfer.setData("shape",JSON.stringify(t))},getData:function(){try{var e=event.dataTransfer.getData("shape"),t=JSON.parse(e);t.position={x:event.offsetX,y:event.offsetY},this.createNode(t),event.preventDefault()}catch(a){}},initScene:function(){this.data=this.$store.state.viewData,this.scene=new l.a.scene("#view2d-canvas",this.data)},animation:function(){this.scene.update(),this.lastTime=(new Date).getTime(),this.animationId=requestAnimationFrame(this.animation)},createNode:function(e){var t=new l.a.Node(e);this.scene.add(t),this.darwLine=!1},updateNode:function(e){this.Node=e,l.a.activeNode.helperBox=!1,l.a.activeNode=this.Node,l.a.activeNode.helperBox=!0},onClickBlank:function(){this.Node=l.a.activeNode,this.contextmenu.left=null},getLocked:function(e){var t=!0;if(e.nodes&&e.nodes.length){var a,o=Object(r["a"])(e.nodes);try{for(o.s();!(a=o.n()).done;){var n=a.value;if(!n.locked){t=!1;break}}}catch(c){o.e(c)}finally{o.f()}}if(t&&e.lines){var i,s=Object(r["a"])(e.lines);try{for(s.s();!(i=s.n()).done;){var l=i.value;if(!l.locked){t=!1;break}}}catch(c){s.e(c)}finally{s.f()}}return t},onUpdateProps:function(e){this.canvas.updateProps(e)},handle_new:function(e){this.canvas.open({nodes:[],lines:[]})},handle_open:function(e){this.handle_replace(e)},handle_replace:function(e){var t=this,a=document.createElement("input");a.type="file",a.onchange=function(e){var a=e.srcElement||e.target;if(a.files&&a.files[0]){a.files[0].name.replace(".json","");var o=new FileReader;o.onload=function(e){var a=e.target.result+"";try{var o=JSON.parse(a);o&&Array.isArray(o.pens)&&t.canvas.open(o)}catch(e){return!1}},o.readAsText(a.files[0])}},a.click()},handle_save:function(){l.a.save()},handle_savePng:function(e){this.canvas.saveAsImage(this.$store.state.file.name+".png")},handle_saveSvg:function(e){var t=new C2S(this.canvas.canvas.width+200,this.canvas.canvas.height+200),a=t.getSerializedSvg();a=a.replace("<defs/>","<defs>\n    <style type=\"text/css\">\n      @font-face {\n        font-family: 'topology';\n        src: url('http://at.alicdn.com/t/font_1331132_h688rvffmbc.ttf?t=1569311680797') format('truetype');\n      }\n    </style>\n    </defs>"),a=a.replace(/--le5le--/g,"&#x");var o=window.URL||window,n=new Blob([a]),i=o.createObjectURL(n),r=document.createElement("a");r.setAttribute("download",this.$store.state.file.name+".svg"),r.setAttribute("href",i);var s=document.createEvent("MouseEvents");s.initEvent("click",!0,!0),r.dispatchEvent(s)},handle_undo:function(e){this.canvas.undo()},handle_redo:function(e){console.log(87)},handle_copy:function(e){this.canvas.activeLayer.pens=this.copyNode(),this.canvas.copy()},copyNode:function(){var e=this,t=this.canvas,a=n(this.canvas.activeLayer.pens);t.clipboard=[];var o=[];return a.forEach((function(t){var a=e.Node.cloneState(t);o.push(a)})),o;function n(e){var t=Array.isArray(e)?[]:{};for(var a in e)e.hasOwnProperty(a)&&("object"===Object(i["a"])(e[a])&&null!==e[a]?t[a]=n(e[a]):t[a]=e[a]);return t}},handle_cut:function(e){this.canvas.cut()},handle_paste:function(e){this.canvas.paste()},handle_state:function(e){this.canvas.data[e.key]=e.value,this.$store.commit("change",{scale:this.canvas.data.scale||1,lineName:this.canvas.data.lineName,fromArrowType:this.canvas.data.fromArrowType,toArrowType:this.canvas.data.toArrowType,fromArrowlockedType:this.canvas.data.locked,bkColor:this.canvas.data.bkColor,bkImage:this.canvas.data.bkImage,gird:this.canvas.data.gird||!0,websocket:this.canvas.data.websocket})},handle_show:function(e){this.$store.commit("addView",e);var t=JSON.stringify(e);this.$router.push({name:"preview",params:{pageData:t}})},onContextMenu:function(e){e.preventDefault(),e.stopPropagation(),null!==l.a.activeNode?(this.Node=l.a.activeNode,e.clientY+360<document.body.clientHeight?this.contextmenu={left:e.clientX+"px",top:e.clientY+"px"}:this.contextmenu={left:e.clientX+"px",bottom:document.body.clientHeight-e.clientY+"px"}):this.contextmenu={left:null,top:null}},onCreateTopo:function(){this.topoShow=!1,this.$store.commit("changeFileName",this.topoName)}},mounted:function(){this.initScene(),this.animation(),window.onresize=this.scene.resize,E.a.get("./static/json/View2d_data_48227133.json").then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},destroyed:function(){cancelAnimationFrame(this.animationId)}},T=I,D=(a("1e07"),Object(v["a"])(T,o,n,!1,null,null,null));t["default"]=D.exports},7110:function(e,t,a){"use strict";a("0fc5")},"7df9":function(e,t,a){},8324:function(e,t,a){"use strict";a("a29b")},a29b:function(e,t,a){},c868:function(module,__webpack_exports__,__webpack_require__){"use strict";var H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("d399"),H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("9d6b"),H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("b8c7"),H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("4d63"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("e186"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("5d63"),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("da02"),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("f667"),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("8a61"),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("7e8e"),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_9__),element_ui__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("edcc"),element_ui__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(element_ui__WEBPACK_IMPORTED_MODULE_10__);__webpack_exports__["a"]={data:function(){return{events:{type:0,action:0,value:"",params:"",APIType:"get",bindValue:""},group:[],equipment:[],sensor:[],backgroundType:0,selectedSensor:null,showSelectedColor:[],drawType:"fill",typeOption:[{value:1,text:"开关"},{value:2,text:"文本信息"},{value:3,text:"状态显示"}],selectedSensorType:"",showData:null,animation:null,resData:null,textName:"ptName",data:null,nodeId:null,nodeData:"",lineDash:0,bgColor:"透明",activeName:"first",nodeIsJson:!1,chooseBgImg:!1,position:{},scaleVal:{},rotateVal:0,value:!1,webscoketOption:{url:"ws://111.231.106.94:8088/websocket/25",animate:!1,showInfo:!1},lineOption:[{label:"—————",value:0},{label:"------------",value:1},{label:"- - - - - - -",value:2},{label:"- · - · - · - ·",value:3}],weightOption:[{label:"正常",value:"normal"},{label:"加粗",value:"bolder"}],fontStyleOption:[{label:"正常",value:"normal"},{label:"倾斜",value:"italic"}],textAlignOption:[{label:"居左",value:"left"},{label:"居中",value:"center"},{label:"居右",value:"right"}],textVerticalOption:[{label:"居顶",value:"top"},{label:"居中",value:"center"},{label:"居底",value:"bottom"}],APIUrl:"https://yun.kexsci.com/yun/api/echart/countProjectStatus",APIType:"get",APIParams:"",bindValue:"",fileName:"",bgList:[{url:"https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3156148005,3827021055&fm=26&gp=0.jpg",name:"背景1"},{url:"https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1898783846,176692612&fm=26&gp=0.jpg",name:"背景2"},{url:"https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1242645534,4182724318&fm=26&gp=0.jpg",name:"背景3"},{url:"./img/star.jpg",name:"背景4"},{url:"./img/star1.jpg",name:"背景5"},{url:"./img/sky.jpg",name:"背景6"}]}},props:{name:{type:String,default:"kx-topo"},Node:{type:Object,require:!0}},updated:function(){},watch:{name:function(){this.fileName=this.name},Node:{handler:function(){null!==this.Node&&(this.position=Object(H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__["a"])({},this.Node.position),this.scaleVal=Object(H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__["a"])({},this.Node.scaleVal),this.rotateVal=this.Node.rotateVal)},deep:!0}},methods:{onchangePos:function(){this.Node.translate(this.position)},onSelectedSensor:function(){},openSelected:function(e){"object"==Object(H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_2__["a"])(this.Node.color[e])?(this.backgroundType="linear"==this.Node.color[e].type?1:2,this.Node.color[e]={type:this.Node.color[e].type,direction:this.Node.color[e].direction,gradient:[this.Node.color[e].gradient[0],this.Node.color[e].gradient[1]]}):this.backgroundType=0},selectedType:function(e){if(0!=this.backgroundType){var t=1==this.backgroundType?"linear":"radial",a=1==this.backgroundType?"to right":"center";this.$set(this.Node.color,e,{type:t,direction:a,gradient:["#ff00ff","#adccff"]})}else this.$set(this.Node.color,e,"#2cafe7")},onLinkSensor:function(){if(this.selectedSensor)if(this.selectedSensorType)switch(Object(element_ui__WEBPACK_IMPORTED_MODULE_10__["Notification"])({type:"success",message:"连接成功",duration:1500}),this.Node.title=this.selectedSensor,1*this.selectedSensorType){case 1:break;case 2:this.webscoketOption.showInfo=!0,this.onLinkWebscoket();break;case 3:this.webscoketOption.animate=!0,this.onLinkWebscoket();break}else Object(element_ui__WEBPACK_IMPORTED_MODULE_10__["Notification"])({type:"warning",message:"请设置类型！",duration:1500});else Object(element_ui__WEBPACK_IMPORTED_MODULE_10__["Notification"])({type:"warning",message:"请选择传感器！",duration:1500})},initData:function(){this.APIUrl="https://yun.kexsci.com/yun/api/echart/countProjectStatus",this.APIType="get",this.APIParams="",this.Node.data=null,this.events={type:0,action:0,value:"",params:"",APIType:"get",bindValue:""}},changeDrawType:function(){var e=this;"node"==this.Node.type?this.Node.drawType=this.drawType:this.Node.traverse((function(t){"node"==t.type&&(t.drawType=e.drawType)}))},onChangeFileName:function(){this.$store.commit("changeFileName",this.fileName)},onChangeColor:function(e){0==this.backgroundType&&this.$store.commit("changeBkColor",this.bgColor)},lineDashChange:function(){switch(this.lineDash){case 0:this.Node.border.lineDash=[0,0];break;case 1:this.Node.border.lineDash=[5,5];break;case 2:this.Node.border.lineDash=[5,10];break;case 3:this.Node.border.lineDash=[5,5,1,5];break}},onSelectedImg:function(e){this.chooseBgImg=!1,this.$store.commit("changeBkImage",this.bgList[e].url)},onDeleBgImg:function(){this.$store.commit("changeBkImage","")},changeGrid:function(){this.$store.commit("changeGrid",this.value)},onChange:function(e){this.$emit("change",this.Node)},onSelected:function(){this.onChange()},onSelectEventDo:function onSelectEventDo(item,index){var _this2=this;switch(item.params.type){case 0:this.Node.events[index].callBack=function(){window.location.href=_this2.Node.events[index].params.value};break;case 1:break;case 2:this.Node.events[index].callBack=function(){eval(_this2.Node.events[index].params.value)};break;case 3:this.Node.events[index].callBack=function(){eval(_this2.Node.events[index].params.value)};break;case 4:break;case 5:break}},changeExpand:function(){},isJson:function(e){return"object"==Object(H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_2__["a"])(e)&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()&&!e.length},onLinkWebscoket:function(){this.webscoketOption.url?(this.$store.commit("changeWebscoket",this.webscoketOption.url),this.$store.commit("resetWebScoket"),this.addEvents()):this.$message({type:"error",message:"Url地址为空!",duration:1500,center:!0})},offLinkWebscoket:function(){var e=this;this.events.bindValue="",this.Node.events.forEach((function(t,a){2==t.type&&e.Node.events.splice(a,1)}))},addEvents:function(){this.events.value=this.webscoketFn(),this.events.type=2,this.events.action=2,this.events.bindValue=this.textName},onLinkAPI:function onLinkAPI(node,item){var _this4=this;return Object(H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__["a"])(regeneratorRuntime.mark((function _callee(){var params,res;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(item&&(_this4.APIParams=item.APIParams,_this4.APIUrl=item.APIUrl,_this4.APIType=item.APIType),params=_this4.APIParams?eval("("+_this4.APIParams+")"):{},res=null,"get"!=_this4.APIType){_context.next=9;break}return _context.next=6,_this4.$axios.get(_this4.APIUrl,{params:params});case 6:res=_context.sent,_context.next=12;break;case 9:return _context.next=11,_this4.$axios.post(_this4.APIUrl,params);case 11:res=_context.sent;case 12:_this4.showData=node.data=JSON.stringify(res),(item?item.bindValue:item)&&(node.text=eval("res."+item.bindValue));case 14:case"end":return _context.stop()}}),_callee)})))()},onBindAPI:function(){var e=this;this.onLinkAPI();var t=!1,a={type:200,action:200,url:this.APIUrl,pramas:this.APIParams,bindValue:this.bindValue,method:this.APIType};this.Node.events.forEach((function(o,n){200==o.type&&(e.Node.events[n]=a,t=!0)})),t||this.Node.events.push(a),this.$emit("change",this.Node)},webscoketFn:function(){if(!this.textName)return"";var e="";return this.webscoketOption.showInfo&&(e+="\n          let info = {name: params.ptName, status: params.ptStatus, data: params.deflection};\n          pen.text = JSON.stringify(info)"),this.webscoketOption.animate&&(e+="\n          switch(params.ptStatus*1){\n            case 0: pen.fillStyle = '#eeeeee';\n            break;\n            case 1: pen.fillStyle = '#00ff00';\n            break;\n            case 2: pen.fillStyle = '#ff0000';\n            break;\n          }\n          window['flash_animate'](pen);"),"if(pen.title == params.".concat(this.textName,"){\n          ").concat(e,"\n          window['updateCanvasNode'](pen);\n        }")},flash_animation:function(e){e.animateFrames=[];var t=this.Node.cloneState(e);t.fillStyle="#eeeeee",e.animateFrames.push({duration:300,linear:!0,state:t});var a=this.Node.cloneState(e);a.fillStyle=e.fillStyle,e.animateFrames.push({duration:300,linear:!0,state:a}),e.animateDuration=0;var o,n=Object(H_workSpace_View2d_node_modules_babel_runtime_7_15_3_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_0__["a"])(e.animateFrames);try{for(n.s();!(o=n.n()).done;){var i=o.value;e.animateDuration+=i.duration}}catch(r){n.e(r)}finally{n.f()}e.animateStart=Date.now()}},mounted:function(){this.bgColor=this.$store.state.data.bkColor||"",this.value=this.$store.state.data.grid,this.group=this.$store.state.userEquipment.userEquipmentGroup}}},c89c:function(e,t,a){"use strict";a("f757")},f757:function(e,t,a){}});
//# sourceMappingURL=app.de0ceaf1.js.map